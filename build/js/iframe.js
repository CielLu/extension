function CSV(){}CSV.prototype={formatCSV:function(e){return null==e?"":"number"==typeof e?e:"object"==typeof e?JSON.stringify(e):'"'+(e=e.replace(/"/g,'""'))+'"'},createCSV:function(e,t){var a=this.formatCSV,i=null;e&&e.length&&(i=e.map(function(e){return a(e.heading)}).join());var s=t.map(function(e){return e.map(function(e){return a(e)}).join()}).join("\r\n");return i?i+"\r\n"+s:s},getStrCSV:function(e,t){return this.createCSV(e,t)},getHrefCSV:function(e,t){var a=this.createCSV(e,t);return URL.createObjectURL(new Blob([a]))},downloadCSV:function(e,t,a){var i=this.createCSV(e,t);this.download(i,a,"application/csv")},download:function(e,t,a){var i=navigator.userAgent.toLowerCase(),s=!1;if(-1!==i.indexOf("safari")&&-1===i.indexOf("chrome"))try{return void window.open("data:"+a+" ;base64,"+btoa(e))}catch(e){s=!0,a="text/plain;charset=UTF-8;"}var n=new Blob([e],{type:a});if(window.navigator.msSaveBlob)window.navigator.msSaveBlob(n,t);else{var c=window.URL.createObjectURL(n);if(s)window.open(c);else{var o=document.createElement("a");document.body.appendChild(o),o.style="display: none",o.href=c,o.download=t,o.click()}setTimeout(function(){window.URL.revokeObjectURL(c)},2e4)}}};var AiApi=function(){this.path="http://localhost:7700/sm"};AiApi.prototype={inference:function(e,t,a){$.ajax({type:"POST",url:this.path+"/inference",success:e,data:JSON.stringify(a),error:t,dataType:"json",contentType:"application/json"})}};var AuthenticationApi=function(e){this.path=e};AuthenticationApi.prototype={signIn:function(e,t,a,i){$.ajax({type:"POST",url:this.path+"/grabbly/api/v1/authenticate",success:e,data:JSON.stringify({email:a,password:i}),xhrFields:{withCredentials:!0},credentials:"same-origin",error:t,dataType:"json",contentType:"application/json"})},signUp:function(e,t,a,i,s,n){$.ajax({type:"POST",url:this.path+"/grabbly/api/v1/create_user",data:JSON.stringify({email:a,first_name:i,last_name:s,password:n}),success:e,error:t,dataType:"json",contentType:"application/json"})}};var ScheduleApi=function(e){this.path=e};ScheduleApi.prototype={get:function(e,t,a){$.ajax({type:"POST",url:this.path+"/grabbly/api/v1/schedules",success:e,error:t,dataType:"json",contentType:"application/json",data:JSON.stringify({pageNumber:a||0})})},delete:function(e,t,a){$.ajax({type:"DELETE",url:this.path+"/grabbly/api/v1/delete_schedule/"+a,success:e,error:t,dataType:"text"})},update:function(e,t,a,i){$.ajax({type:"PUT",url:this.path+"/grabbly/api/v1/update_schedule/"+a,data:JSON.stringify(i),success:e,error:t,dataType:"text",contentType:"application/json"})},create:function(e,t,a){$.ajax({type:"POST",url:this.path+"/grabbly/api/v1/create_schedule",data:JSON.stringify(a),success:e,error:t,dataType:"json",contentType:"application/json"})}};var SurveyApi=function(e){this.path=e};SurveyApi.prototype={get:function(e,t){$.ajax({type:"GET",url:this.path+"/survey/api/v1/get_survey",success:e,error:t,contentType:"application/json"})},post:function(e,t,a){$.ajax({type:"POST",url:this.path+"/survey/api/v1/set_answers",success:e,error:t,dataType:"json",contentType:"application/json",data:JSON.stringify(a)})}};var JobApi=function(e){this.path=e};JobApi.prototype={get:function(e,t,a){$.ajax({type:"POST",url:this.path+"/grabbly/api/v1/jobs_url",success:e,error:t,dataType:"json",contentType:"application/json",data:JSON.stringify({url:a})})},getFiltered:function(e,t,a){$.ajax({type:"POST",url:this.path+"/grabbly/api/v1/jobs_url_filtered",success:e,error:t,dataType:"json",contentType:"application/json",data:JSON.stringify({url:a})})},getFilteredAndMine:function(e,t,a){$.ajax({type:"POST",url:this.path+"/grabbly/api/v1/jobs_url_filtered_and_mine",success:e,error:t,dataType:"json",contentType:"application/json",data:JSON.stringify({url:a})})},getPopularAndMine:function(e,t,a){$.ajax({type:"POST",url:this.path+"/grabbly/api/v1/jobs_popular_and_mine",success:e,error:t,dataType:"json",contentType:"application/json",data:JSON.stringify({url:a})})},getMyJobs:function(e,t,a){$.ajax({type:"POST",url:this.path+"/grabbly/api/v1/my_jobs",success:e,error:t,data:JSON.stringify({page_number:a||0}),dataType:"json",contentType:"application/json"})},getById:function(e,t,a){$.ajax({type:"GET",url:this.path+"/grabbly/api/v1/job/"+a,success:e,error:t,dataType:"json"})},create:function(e,t,a){$.ajax({type:"POST",url:this.path+"/grabbly/api/v1/create_job",data:JSON.stringify(a),success:e,error:t,dataType:"json",contentType:"application/json"})},update:function(e,t,a,i){$.ajax({type:"PUT",url:this.path+"/grabbly/api/v1/job/"+a,data:JSON.stringify(i),success:e,error:t,dataType:"text",contentType:"application/json"})},delete:function(e,t,a){$.ajax({type:"DELETE",url:this.path+"/grabbly/api/v1/job/"+a,success:e,error:t,dataType:"text"})},upload:function(e,t,a,i){$.ajax({type:"POST",url:i,data:a,processData:!1,contentType:!1,success:e,error:t})},reportActivity:function(e,t,a,i){$.ajax({type:"POST",url:this.path+"/grabbly/api/v1/report_activity",data:JSON.stringify({quota:a,jobId:i}),success:e,error:t,contentType:"application/json",dataType:"json"})},retrieveQuota:function(e,t){$.ajax({type:"GET",url:this.path+"/grabbly/api/v1/retrieve_quota",success:e,error:t,dataType:"json"})},getVideoUrls:function(e,t){$.ajax({type:"GET",url:this.path+"/grabbly/api/v1/get_video_urls",success:e,error:t,dataType:"json"})},getHowItWorksVideos:function(e,t){$.ajax({type:"GET",url:this.path+"/grabbly/api/v1/get_how_it_works_videos",success:e,error:t,dataType:"json"})}};var environment=null,mode=null,email="",jobApi=null,authenticationApi=null,aiApi=null,scheduleApi=null,surveyApi=null;function setEnvironment(e){"DEV"==e.environment?(environment="http://localhost:8080",environment="https://localhost:8443",environment="https://www.grabbly.io"):environment="https://www.grabbly.io",aiApi=new AiApi(environment),jobApi=new JobApi(environment),surveyApi=new SurveyApi(environment),authenticationApi=new AuthenticationApi(environment),scheduleApi=new ScheduleApi(environment)}function fail(e,t,a){console.log(e),console.log(t+" : "+e.responseText+" : "+a),status("Failure",!1),window.parent.postMessage({method:"status",data:JSON.stringify({jqXHR:e,textStatus:t,errorThrown:a})},"*")}function spinnerFail(e,t,a){$("#spinner").hide(),fail(e,t,a)}function formatRecipes(e){return e.map(function(e){var t=JSON.parse(e.data);return t.id=e.id,t.owner=e.owner,t.public=e.public,t.isPopular=!!e.type,t})}function formatSchedules(e){return e.map(function(e){var t=e.data;return t.id=e.id,t})}function status(e,t,a){a||(a=3e3),$("#status").addClass("show"),$("#status").text(e),setTimeout(function(){$("#status").removeClass("show")},a)}function urlToFilename(e){return e.replace(/[^-a-zA-Z0-9\.]+/g,"_")}function addToZip(e,t,a){e.file(t,a)}function createZip(){return new JSZip}function getTestData(){for(var e=[],t=0;t<1e4;t++){for(var a=[],i=0;i<25;i++)a.push("my test test of all tests");e.push(a)}return(new CSV).getStrCSV([],e)}function splitData(e,t,a,i,s){for(var n=[],c=e.length%t>0?1:0,o=0;o<parseInt(e.length/t,10)+c;o++){var r=o*t+t>e.length?e.length:o*t+t,l=e.slice(o*t,r);"CSV"===i?n.push({apiEndpoint:s,name:a+"-"+o+".csv",data:(new CSV).getStrCSV([],l)}):n.push({apiEndpoint:s,name:a+"-"+o+".json",data:JSON.stringify(l)})}return n}function uuidv4(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}function formatDate(e){e||(e=new Date);var t=e.getHours(),a=e.getMinutes(),i=e.getMonth()+1,s=e.getDate(),n=e.getFullYear(),c=e.getSeconds();return n+"-"+(i=i<10?"0"+i:i)+"-"+(s=s<10?"0"+s:s)+" "+((t=t<10?"0"+t:t)+":"+(a=a<10?"0"+a:a)+":"+(c=c<10?"0"+c:c)+":"+e.getMilliseconds())}function b64toBlob(e,t,a){t=t||"",a=a||512;for(var i=atob(e.split(",")[1]),s=[],n=0;n<i.length;n+=a){for(var c=i.slice(n,n+a),o=new Array(c.length),r=0;r<c.length;r++)o[r]=c.charCodeAt(r);var l=new Uint8Array(o);s.push(l)}return new Blob(s,{type:t})}function attachAutocomplete(e,t){$(e).textcomplete([{words:t,match:/\b(\w{2,})$/,search:function(e,t){t($.map(this.words,function(t){return t.indexOf(e)>-1?t:null}))},index:1,replace:function(e){return e+" "}}])}function loadDropdown(e,t,a){$(e).empty();var i="";i+="<option value=''></option>";for(var s=0;s<t.length;s++)i+="<option value='"+t[s].id+"'>"+t[s][a||"name"]+"</option>";$(e).append(i)}function traverseClean(e){if(e.localName&&e.localName.toLowerCase()in{script:void 0,style:void 0})$(e).remove();else for(var t=e.childNodes,a=0;a<t.length;a++)traverseClean(t[a])}function cleanNode(e){if(e.nodeType!==Node.COMMENT_NODE){if(!isValidNode(e))return!1;$(e).removeClass(),$(e).removeAttr("id"),$(e).attr("href")&&$(e).attr("href",e.href);for(var t=0;t<e.attributes.length;t++)"href"!=e.attributes[t].name&&$(e).removeAttr(e.attributes[t].name);var a=e.childNodes;for(t=0;t<a.length;t++)cleanNode(a[t])}else $(e).remove()}function traverse(e,t,a,i){if(!a||!isValidNode(e)||!1!==a(e,t)){for(var s=e.childNodes,n=0;n<s.length;n++)traverse(s[n],t+1,a,i);!i||!isValidNode(e)||i(e,t)}}var regexCache={};function regexTest(e,t){if(!e)return!0;if(!e.trim())return!0;var a=e.split("\n").map(function(e){return e.trim()});a.map(function(e){e in regexCache||(regexCache[e]=new RegExp(e))});for(var i=0;i<a.length;i++)if(t.match(regexCache[a[i]]))return!0;return!1}var url,host,videos,howItWorksVideos,autoOpen,entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function escapeHtml(e){return String(e).replace(/[&<>"'`=\/]/g,function(e){return entityMap[e]})}function getOwnText(e){try{for(var t=$(e).contents().filter(function(){return 3==this.nodeType}),a="",i=0;i<t.length;i++)a+=t[i].nodeValue,i<t.length-1&&(a+="");return a}catch(e){return""}}function getOwnHtml(e){return $(createElement(e.outerHTML)).clone().children().remove().end().html()}function getJobDependencies(e,t,a,i,s,n){e||(e=[]),e=(e=Array.from(new Set(e))).filter(function(e){return!!e}).map(function(e){return parseInt(e,10)}).filter(function(e){return i?!(e in a):!(e in t)});for(var c=0;c<e.length;c++)n.cnt+=1,jobApi.getById(function(e){n.cnt-=1,formatRecipes([e]).map(function(e){if(i?a[e.id]=e:t[e.id]=e,getJobDependencies(e.links,t,a,i||!1,s,n),getJobDependencies(e.row.visitUrlJobs,t,a,!0,s,n),e.columns)for(var c=0;c<e.columns.length;c++)getJobDependencies(e.columns[c].visitUrlJobs,t,a,!0,s,n);if(e.details)for(c=0;c<e.details.length;c++)getJobDependencies(e.details[c].visitUrlJobs,t,a,!0,s,n);0===n.cnt&&s&&s(t,a)})},fail,e[c])}function isValidNode(e){return!(1!==e.nodeType||e.localName.toLowerCase()in{script:void 0,style:void 0})}function createElement(e){var t=document.createElement("template");return t.innerHTML=e,t.content.firstChild}function createElementFragment(e){var t=document.createDocumentFragment(),a=document.createElement("div");for(a.innerHTML=e;a.firstChild;)t.appendChild(a.firstChild);return t}function move(e,t,a){for(;t<0;)t+=e.length;for(;a<0;)a+=e.length;if(a>=e.length)for(var i=a-e.length;1+i--;)e.push(void 0);return e.splice(a,0,e.splice(t,1)[0]),e}function combination(e,t){var a=[];if(a.push(e),0===t.length)return a;for(var i=0;i<t.length;i++){var s=e.slice(0);s.push(t[i]),a=a.concat(combination(s,t.slice(i+1)))}return a}function createSequence(e){for(var t=[],a=0;a<e;a++)t.push(0);return t}function getNumericCnt(e){for(var t=0,a=0;a<e.length;a++)new Set("0123456789".split("")).has(e[a])&&(t+=1);return t}function getAddresses(e){var t=[];return new Address(e).runPipeline(),$(e).find(".grabbly-address").each(function(e){t.push($(this).text().replace(/  |\r\n|\n|\r|\t/gm," "))}),t}function getPhones(e){var t=e.match(/(?:(?:\+?([1-9]|[0-9][0-9]|[0-9][0-9][0-9])\s*(?:[.-]\s*)?)?(?:\(\s*([2-9]1[02-9]|[2-9][02-8]1|[2-9][02-8][02-9])\s*\)|([0-9][1-9]|[0-9]1[02-9]|[2-9][02-8]1|[2-9][02-8][02-9]))\s*(?:[.-]\s*)?)?([2-9]1[02-9]|[2-9][02-9]1|[2-9][02-9]{2})\s*(?:[.-]\s*)?([0-9]{4})(?:\s*(?:#|x\.?|ext\.?|extension)\s*(\d+))?/g)||[];return t=(t=(t=(t=Array.from(new Set(t))).filter(function(e){return!!e})).map(function(e){return e.trim()})).filter(function(e){var t=getNumericCnt(e);return!!new Set([7,10,11,12,13]).has(t)&&(!!new Set([1,3]).has(e.split(".").length)&&!(t>6&&t===e.length))}),Array.from(new Set(t))}function getRowGroups(e){for(var t={},a=0;a<e.length;a++)null!=e[a].row&&(e[a].row in t||(t[e[a].row]=[]),t[e[a].row].push(e[a]),e[a].index=a);return t}function getEmails(e){for(var t=[],a=[],i=-1,s=new Set(['"',";",":","<",">"," ","/","\\","{","}","&","?","(",")","$","=","\n","\r\n","\t"]),n=0;n<e.length;n++)n===e.length-1||s.has(e[n])||i>-1&&"@"==e[n]?(i>0&&i<a.length-1&&t.push(a.join("").trim()),a=[],i=-1):("@"==e[n]&&(i=a.length),a.push(e[n]));return Array.from(new Set(t))}function getVideoUrls(){jobApi.getVideoUrls(function(e){videos=e,$(".detail-video").attr("href",e.detail),$(".row-video").attr("href",e.row),$(".column-video").attr("href",e.column),$(".navigation-video").attr("href",e.navigation),$(".action-video").attr("href",e.action),$(".clean-video").attr("href",e.clean),$(".overview-video").attr("href",e.overview),$(".crawl-video").attr("href",e.crawl),$(".job-type-video").attr("href",e.jobType),$(".ez-scrape-video").attr("href",e.ezScrape)},function(){})}function getHowItWorksVideos(){jobApi.getHowItWorksVideos(function(e){howItWorksVideos=e},function(){})}function enableSpinner(){$("#spinner").show()}function disableSpinner(){$("#spinner").hide()}function getRecipes(){var e=function(e){schedules=formatSchedules(e),initGetRecipes(),initSurvey(),$("#grabbly-parent").remove()},t=function(e){disableSpinner(),showLogin()};enableSpinner(),jobApi.retrieveQuota(function(a){showNumberTabs=!1,a.parallel_scraping_enabled,showCustomJS=a.custom_js_enabled,showDeepCrawl=a.deep_crawl_enabled,showApiEndpoint=!1,a.api_callback_enabled,showPrivateTab=!0,showScheduleTab=!1,showDownload=a.download_enabled,jobApi.getPopularAndMine(function(a){recipes=formatRecipes(a.jobs),myJobs=formatRecipes(a.myJobs),recipes=recipes.concat(myJobs),scheduleApi.get(e,t)},t,encodeURI(url))},t)}function displayQuotaLeft(e){console.log(e+" Grabbs left"),e<=0?status("You have no more Grabbs left.  For more Grabbs upgrade your plan.",!0,17e3):status("You have "+e+" Grabbs left",e>0)}function getSchedules(){enableSpinner(),scheduleApi.get(function(e){disableSpinner(),schedules=formatSchedules(e),listItems(),showItems()},function(e){disableSpinner(),showLogin()})}function yank(){window.parent.postMessage({method:"yank"},"*"),$(".spinner-text").show()}var lastFileUpdate=null;function initWindowEventListeners(){window.addEventListener("message",function(e){if("selectedText"===e.data.method)$("#selected-text").text(e.data.data);else if("updatePercentage"==e.data.method){console.log("percentage update "+e.data.data);e.data.data}else if("automaticListJob"==e.data.method){var t=JSON.parse(e.data.data);(i=window.recipe).row.jquery=t.rowJquery.join(" , "),t.columns.length&&(i.columns=[]);for(var a=0;a<t.columns.length;a++){if((r=createQuery()).jquery=t.columns[a]?t.columns[a]:"",i.columns.push(r),"a"===t.columnTypes[a].toLowerCase().trim())(r=createQuery()).jquery=t.columns[a]?t.columns[a]:"",r.extractType="href",i.columns.push(r);else if("img"===t.columnTypes[a].toLowerCase().trim()){(r=createQuery()).extractType="image-src",r.jquery=t.columns[a]?t.columns[a]:"",i.columns.push(r)}}t.navigationPath&&(i.navigate.jquery=t.navigationPath,i.navigate.waitTime=1,i.navigate.maxClicks=3),mapQueryToUI(),disableSpinner()}else if("login-success"==e.data.method)getRecipes();else if("scrollStopped"==e.data.method)$("#recipe-edit-section").is(":visible")&&applyQuery();else if("user-authenticated"==e.data.method)getRecipes();else if("re-yank"==e.data.method)disableSpinner();else if("yank"==e.data.method){$(".spinner-text").hide();var i=window.recipe;if(e.data&&e.data.data&&0===i.columns.length){var s=(t=e.data.data).columnSelectors,n=this.getRowGroups(s);for(var c in n)for(s=n[c],a=0;a<s.length;a++){var o=s[a];if(o.hasText){1;var r,l=o.column,d=o.row;(r=createQuery()).jquery=l,r.row={jquery:d},i.columns.push(r)}}}applyQuery(),disableSpinner()}else if("getFiles"==e.data.method){window.url=e.data.data.url;var u=JSON.stringify(e.data.data.files);if(u===lastFileUpdate)return;window.files=e.data.data.files,listFiles(),lastFileUpdate=u}else if("downloadScreenshot"===e.data.method){var p=document.createElement("a");document.body.appendChild(p),p.style="display: none",p.href=e.data.data,p.download=host+".png",p.click(),setTimeout(function(){URL.revokeObjectURL(e.data.data)},12e4)}else if("collapseRight"===e.data.method)$("#main").hide(),$("#view-right").hide(),$("#view-left").hide(),$("#view-close").hide();else if("expandRight"===e.data.method)$("#main").show(),$("#view-right").show(),$("#view-left").show(),$("#view-close").show();else if("collapseLeft"===e.data.method)$("#main").hide(),$("#view-left").hide(),$("#view-right").hide(),$("#view-close").hide();else if("expandLeft"===e.data.method)$("#main").show(),$("#view-left").show(),$("#view-right").show(),$("#view-close").show();else if("quotaLeft"===e.data.method){displayQuotaLeft(e.data.data)}else if("dataPreview"===e.data.method){previewData((h=e.data.data).table)}else if("selectedElement"===e.data.method)setQuery(e.data.data);else if("downloadDone"===e.data.method)$(".file-download").show();else if("setLinkJobToColumn"===e.data.method){var h=e.data.data;for(a=0;a<window.recipe.columns.length;a++)if(window.recipe.columns[a].visitLinkId==h.visitLinkId){try{for(var m=!1,y=0;y<window.myJobs.length;y++)if(window.myJobs[y].id==h.jobId){m=!0;break}if(!m){var f=createNewJob();f.name="EZ-placeholder",f.id=h.jobId,window.myJobs.push(f)}window.recipe.columns[a].visitUrlJobs=[h.jobId],mapQueryToUI();break}catch(e){}break}}else if("downloadCSV"===e.data.method){p=document.createElement("a");document.body.appendChild(p),p.style="display: none",p.href=e.data.data.href,p.download=host+"."+e.data.data.type,p.click(),setTimeout(function(){URL.revokeObjectURL(e.data.data.href)},12e4)}else if("init"===e.data.method){window.parent.postMessage({method:"status",data:JSON.stringify(e.data.data)},"*"),window.url=e.data.data?e.data.data.url:"http://www.grabbly.io/test",window.host=e.data.data?e.data.data.host:"www.grabbly.com";var v=e.data.data?e.data.data.environment:"DEV",b=e.data.data?e.data.data.name:"Grabbly";setEnvironment({url:url,name:b,host:host,environment:v}),getRecipes(),getVideoUrls(),getHowItWorksVideos(),autoOpen=e.data.data?e.data.data.autoOpen:null}else"updateStatus"===e.data.method?console.log(e.data.data):e.data.method})}function initGetRecipes(){if(autoOpen){if(listItems(),autoOpen.jobId)for(var e=0;e<window.recipes.length;e++)window.recipes[e].id==autoOpen.jobId&&(window.recipe=window.recipes[e]);else window.recipe=createNewJob(),window.recipe.typeSelected="easy-scrape",window.recipe.type="list",window.recipe.columns.splice(window.recipe.columns.length-1,1);return openJob(),stepType="easy-scrape-details",mapQueryToUI(),enableSpinner(),void yank()}if(new Set(["private","public"]).has(jobTabType)){var t=localStorage.getItem("recipe");if(showItems(),listItems(),t){t=JSON.parse(t),window.recipe=t.recipe;var a=JSON.parse(JSON.stringify(window.recipe.saveSpot));if(openJob(),"save"===a.stepType?$("#tab-save").click():"crawl"===a.stepType?$("#tab-crawl").click():"type"===a.stepType?$("#tab-type").click():"details"===a.stepType?($("#tab-details").click(),selectDetail(a.tabIndex)):"row"===a.stepType?$("#tab-row").click():"column"===a.stepType?($("#tab-columns").click(),selectColumn(a.tabIndex,window.recipe.columns)):"navigate"===a.stepType?$("#tab-navigate").click():"action"===a.stepType?($("#tab-action").click(),selectAction(a.tabIndex)):"clean"===a.stepType?$("#tab-clean").click():"easy-scrape-column-details-edit"===a.stepType?selectColumn(a.tabIndex,window.recipe.columns):"easy-scrape-column-details"===a.stepType?selectColumn(a.tabIndex,window.recipe.columns):"easy-scrape-details"===a.stepType?mapQueryToUI():"easy-scrape-pagination"===a.stepType?mapQueryToUI():"easy-scrape-column-edit"===a.stepType?selectColumn(a.tabIndex,window.recipe.columns):"easy-scrape-column"===a.stepType?selectColumn(a.tabIndex,window.recipe.columns):"easy-scrape"===a.stepType?mapQueryToUI():"easy-scrape-save"===a.stepType&&mapQueryToUI(),"easy-scrape"===window.recipe.typeSelected)return void enableSpinner()}}disableSpinner()}function initEventListeners(){$('[data-toggle="tooltip"]').tooltip(),$("#selected-element-formatted-tags-toggle").click(function(e){e.preventDefault(),e.stopImmediatePropagation(),$("#selected-element-formatted-tags-toggle").hasClass("active")?($("#tabs-data .tabs").removeClass("active"),$("#selected-element-formatted-tags-toggle").removeClass("active"),$("#selected-element-formatted-tags").hide(),$("#extract-data-parent").hide(),$("#help-diagram").hide()):($("#tabs-data .tabs").removeClass("active"),$("#selected-element-formatted-tags-toggle").addClass("active"),$("#selected-element-formatted-tags").show(),$("#extract-data-parent").hide(),$("#help-diagram").hide())}),$("#extract-data-toggle").click(function(e){e.preventDefault(),e.stopImmediatePropagation(),applyQuery(),$("#extract-data-toggle").hasClass("active")?($("#tabs-data .tabs").removeClass("active"),$("#help-diagram-toggle").removeClass("active"),$("#extract-data-toggle").removeClass("active"),$("#selected-element-formatted-tags").hide(),$("#extract-data-parent").hide(),$("#help-diagram").hide()):($("#tabs-data .tabs").removeClass("active"),$("#help-diagram-toggle").removeClass("active"),$("#extract-data-toggle").addClass("active"),$("#selected-element-formatted-tags").hide(),$("#extract-data-parent").show(),$("#help-diagram").hide())}),$("#help-diagram-toggle").click(function(e){e.preventDefault(),e.stopImmediatePropagation(),$("#help-diagram-toggle").hasClass("active")?($("#tabs-data .tabs").removeClass("active"),$("#help-diagram-toggle").removeClass("active"),$("#extract-data-toggle").removeClass("active"),$("#selected-element-formatted-tags").hide(),$("#extract-data-parent").hide(),$("#help-diagram").hide()):($("#tabs-data .tabs").removeClass("active"),$("#extract-data-toggle").addClass("active"),$("#extract-data-toggle").removeClass("active"),$("#selected-element-formatted-tags").hide(),$("#extract-data-parent").hide(),$("#help-diagram").show())}),$("#ez-scrape-form-button-close, #extract-data-button-close, #help-diagram-button-close, #html-data-button-close").click(function(){$("#extract-data-parent").hide(),$("#help-diagram").hide(),$("#selected-element-formatted-tags").hide(),$("#ez-scrape-form").hide(),$("#tabs-data .tabs").removeClass("active"),$("#extract-data-toggle").removeClass("active"),$("#help-diagram-toggle").removeClass("active")}),$(".select-parent-tag").mousedown(function(e){this.style.backgroundColor="black",this.style.color="white"}),$(".select-parent-tag").mouseup(function(e){this.style.backgroundColor="white",this.style.color="black"}),$(".select-child-tag").mousedown(function(){this.style.backgroundColor="black",this.style.color="white"}),$(".select-child-tag").mouseup(function(){this.style.backgroundColor="white",this.style.color="black"}),$("#index-up").mousedown(function(){$("#index-up")[0].style.backgroundColor="black",$("#index-up")[0].style.color="white"}),$("#index-up").mouseup(function(){$("#index-up")[0].style.backgroundColor="white",$("#index-up")[0].style.color="black"}),$("#index-down").mousedown(function(){$("#index-down")[0].style.backgroundColor="black",$("#index-down")[0].style.color="white"}),$("#index-down").mouseup(function(){$("#index-down")[0].style.backgroundColor="white",$("#index-down")[0].style.color="black"}),$(".select-parent-tag").click(function(){window.parent.postMessage({method:"parentElement",data:""},"*")}),$(".select-child-tag").click(function(){window.parent.postMessage({method:"childElement",data:""},"*")}),$("#user-name").change(function(){email=$("#user-name").val().trim()}),$("#login").click(function(){enableSpinner(),authenticationApi.signIn(function(e){disableSpinner(),getRecipes()},function(e){disableSpinner(),status(getStatusString(JSON.parse(e.responseText).error_code).display,!1)},email,$("#password").val())}),$("#forgot-password").click(function(){}),$("#sign-up-new-account").click(function(){showSignUp()}),$("#create-account-cancel").click(function(){showLogin()}),$("#create-account-sign-up").click(function(){email=$("#create-account-email").val().trim();var e=$("#create-account-password").val().trim(),t=$("#create-account-repeat-password").val().trim(),a=$("#create-account-first").val().trim(),i=$("#create-account-last").val().trim();e!==t?status("Passwords do not match.",!1):a.length<1?status("Please specify a first name.",!1):i.length<1?status("Please specify a last name.",!1):(enableSpinner(),authenticationApi.signUp(function(e){disableSpinner(),token=e.token,status("Account created. A validation email has been sent to your inbox.",!0),showLogin()},function(e){disableSpinner(),status(getStatusString(JSON.parse(e.responseText).error_code).display,!1)},email,a,i,e))})}function createTable(e,t,a,i){function s(e,t){var a=e;return a||(a=""),a.length>t&&(a=a.trim().substr(0,t)+"..."),{original:e,modified:a}}var n=null==i?16:50,c="";if(e&&e.length){c+="<thead><tr>";for(var o=0;o<e.length;o++){if(null==i||o==i)c+='<th class="grabbly-cell-header" id="ez-col-'+o+'"title="'+(d=s(e[o],n)).original+'" ><span class="edit">'+escapeHtml(d.modified)+"</span>"+(a?'<span class="delete" style="float: right;display: none;"> <i class="far fa-window-close"></i> </span>':"")+"</th>"}c+="</tr></thead><tbody>"}for(var r=0;r<t.length;r++){var l=t[r];c+="<tr>";for(o=0;o<l.length;o++){var d;if(null==i||o==i)c+='<td class="grabbly-cell" title="'+(d=s(l[o],n)).original+'">'+escapeHtml(d.modified)+"</td>"}c+="</tr>"}return c+="</tbody>"}function previewData(e){var t=recipe.columns;"detail"==recipe.type&&(t=recipe.details);for(var a=[],i=0;i<t.length;i++)a.push(t[i].columnName?t[i].columnName:"Col "+(i+1));if("easy-scrape-column"==stepType||"easy-scrape-column-details"==stepType||"easy-scrape-column-edit"==stepType||"easy-scrape-column-details-edit"==stepType)return $("#ez-scrape-extract-data").html(createTable(null,e,!1,tabIndex)),$("#visit-link-section").hide(),void("href"===query.extractType&&$("#visit-link-section").show());if("easy-scrape"!=recipe.typeSelected){$("#extract-data").html(createTable(a,e,!1));var s="";for(i=0;i<a.length;i++)s+='<button id="extract-data-button'+i+'">'+a[i]+"</button>";s+='<button id="extract-data-button-all">All</button>',s+='<button id="extract-data-button-none">None</button>',$("#extract-data-buttons").html(s);for(i=0;i<t.length;i++)!function(e){$("#extract-data-button"+e).click(function(){"show"in t[e]?(t[e].show=!t[e].show,$("#extract-data-button"+e).css("background-color","#37265b"),$("#extract-data-button"+e).css("color","white")):(t[e].show=!1,$("#extract-data-button"+e).css("background-color","white"),$("#extract-data-button"+e).css("color","#37265b")),$("#extract-data tr > *:nth-child("+(e+1)+")").toggle()})}(i);for(i=0;i<t.length;i++)"show"in t[i]&&!t[i].show?($("#extract-data tr > *:nth-child("+(i+1)+")").hide(),$("#extract-data-button"+i).css("background-color","white"),$("#extract-data-button"+i).css("color","#37265b")):($("#extract-data-button"+i).css("background-color","#37265b"),$("#extract-data-button"+i).css("color","white"));$("#extract-data-button-all").click(function(){for(var e=0;e<t.length;e++)$("#extract-data tr > *:nth-child("+(e+1)+")").show(),$("#extract-data-button"+e).css("background-color","#37265b"),$("#extract-data-button"+e).css("color","white")}),$("#extract-data-button-none").click(function(){for(var e=0;e<t.length;e++)$("#extract-data tr > *:nth-child("+(e+1)+")").hide(),$("#extract-data-button"+e).css("background-color","white"),$("#extract-data-button"+e).css("color","#37265b")})}else if(e.length){$("#ez-scrape-extract-data").html(createTable(a,e,!0));for(var i=0;i<recipe.columns.length;i++)!function(e){var t="#ez-col-"+e,a="#ez-col-"+e+" > .delete";$("#ez-col-"+e+" > .edit").click(function(){stepType="easy-scrape"===stepType?"easy-scrape-column-edit":"easy-scrape-column-details-edit",listColumns(recipe.columns),selectColumn(e,recipe.columns),tabIndex=e,backupQuery=JSON.parse(JSON.stringify(recipe.columns[e]))}),$(a).click(function(){recipe.columns.splice(e,1),applyQuery()}),$(t).hover(function(){$(a).show()},function(){$(a).hide()})}(i)}else{for(var i=0;i<6;i++)e.push([" "," "]);$("#ez-scrape-extract-data").html(createTable([" "," "],e))}}function getSelectedElement(){window.parent.postMessage({method:"getSelectedElement",data:""},"*")}function triggerGetSchedules(){window.parent.postMessage({method:"getSchedules",data:""},"*")}function googleAnalytics(){var e=e||[];e.push(["_setAccount","ADD GA CODE HERE"]),e.push(["_trackPageview"]),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://ssl.google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()}var survey=null;function initSurvey(){$("#survey").hide(),$("#why-section").hide(),surveyApi.get(function(e){(survey=e).length&&$("#survey").show()},fail),$(".recommend").click(function(){for(var e=$("input[name='recommend']:checked").val(),t=0;t<survey.length;t++)"selectOne"==survey[t].type&&surveyApi.post(function(){},fail,[{id:survey[t].id,value:e}]);console.log("value = "+e),$("#why-section").show()}),$("#submit-survey").click(function(){for(var e=$("#why").val(),t=0;t<survey.length;t++)"text"==survey[t].type&&surveyApi.post(function(){},fail,[{id:survey[t].id,value:e}]);$("#survey").hide()})}function showNone(){$("#sign-up-section").hide(),$("#login-section").hide(),$("#entire-recipe-section").hide(),$("#selected-element-formatted-tags").hide(),$("#selected-element-text").hide(),$("#extract-data-parent").hide(),$("#help-diagram").hide()}function showSignUp(){$("#sign-up-section").show(),$("#login-section").hide(),$("#entire-recipe-section").hide()}function showLogin(){$("#sign-up-section").hide(),$("#login-section").show(),$("#entire-recipe-section").hide();var e=document.createElement("div");e.id="grabbly-parent";var t=document.createElement("iframe");t.id="grabbly-iframe",t.src=environment+"/#login2",e.appendChild(t),document.body.appendChild(e)}function showItems(){$("#sign-up-section").hide(),$("#login-section").hide(),$("#recipe-edit-section").hide(),$("#meta-data-section").hide(),$("#schedule-edit-section").hide(),$("#entire-recipe-section").show(),$("#recipes-section").show()}$(document).ready(function(){showNone(),initWindowEventListeners(),initEventListeners(),initRecipeEventListeners(),window.parent.postMessage({method:"init"},"*"),$(".time-slot").click(function(){$(this).attr("data-selected")?$(this).removeAttr("data-selected"):$(this).attr("data-selected","selected")})}),$("#toggle-switch-side").click(function(){window.parent.postMessage({method:"toggleSwitchSide",data:""},"*")});var editor,editorClean,recipe,schedule,backupRecipe,backupSchedule,query,backupQuery,files,confirmStatusPostFunc,stepType="",recipes=[],myJobs=[],schedules=[],showNumberTabs=!1,showCustomJS=!1,showDeepCrawl=!1,showApiEndpoint=!1,showPrivateTab=!1,showScheduleTab=!1,showDownload=!1,jobTabType="private",filePause={},tabIndex=null,queryStack=[],queryIndex=0;function runConfirm(e,t,a){confirmStatusPostFunc=a,$("#modal-body").text(t),$("#modal-title").text(e),$("#myModal").modal("show")}function createElementType(e,t,a){var i=createElement($("#"+a)[0].outerHTML);return i.setAttribute("id",e),$("#"+t).append(i),$("#"+e)}function listItems(){$("#schedule-edit-section").is(":visible")||$("#recipe-edit-section").is(":visible")||($("body").css("background-color","white"),showItems(),new Set(["private","public"]).has(jobTabType)?(listJobs(),listFiles(),listSchedules()):"howItWorks"===jobTabType&&listHowItWorks())}function addNew(){recipes.push(createNewJob()),selectJob(recipes.length-1),openJob()}function setSelectedElementMetaInfo(e){var t=createElement(e),a="";traverse(t,0,function(e,t){a+='<ul class="extract-html">';var i=[],s=e.getAttribute("id");s&&i.push("id: <b>"+s+"</b>");for(var n=[],c=0;c<e.classList.length;c++)!(s=e.classList[c])||s.startsWith("datagasm-")||s.startsWith("grabbly-")||n.push(s);n.length&&i.push("<br/>classes: <b>"+n.join(", ")+"</b>"),(s=e.getAttribute("value"))&&i.push("<br/>value: <b>"+s+"</b>");try{var o=getOwnText(e);o&&o.trim().length&&i.push("<br/>text: <b>"+o.trim()+"</b>")}catch(e){}a+="<li>",a+="&lt;"+e.localName.toUpperCase()+"&gt; "+i.join(" "),a+="</li>"},function(e,t){a+="</ul>"}),$("#selected-element-formatted-tags-content").html(a),$("#selected-element-html").text(t.outerHTML),$("#selected-element-text").text(t.outerText)}function deleteSchedule(e){for(var t=null,a=0;a<schedules.length;a++)if(schedules[a].id===e){t=a;break}null!==t&&runConfirm("Please Confirm","Are you sure you want to delete the schedule?",function(a){a&&scheduleApi.delete(function(){schedules.splice(t,1),schedule=null,triggerGetSchedules(),listItems()},fail,e)})}function selectSchedule(e){schedule=schedules[e],backupSchedule=JSON.parse(JSON.stringify(schedule))}function openSchedule(){$("#recipes-section").hide(),$("#schedule-edit-section").show(),mapScheduleToUI()}function createNewSchedule(){return{id:null,jobId:null,name:"",url:"",description:"",scheduleType:"1",startDate:moment().format("YYYY-MM-DD"),startTime:moment().format("HH:mm"),scheduleEveryXMinute:1,scheduleEveryXHour:1,scheduleEveryXDay:1,scheduleEveryXWeek:1,scheduleEveryXMonth:1,scheduleEveryXYear:1,pageCounts:{}}}function listSchedules(){for(var e=0;e<schedules.length;e++)!function(e){try{var t=schedules[e];$("#job-item-"+t.jobId).find(".job-schedule").css("color","#e258c4")}catch(e){}}(e)}function mapScheduleToUI(){$("#schedule-every-x-minute-section").hide(),$("#schedule-every-x-hour-section").hide(),$("#schedule-every-x-day-section").hide(),$("#schedule-every-x-week-section").hide(),$("#schedule-every-x-month-section").hide(),$("#schedule-every-x-minute").val(schedule.scheduleEveryXMinute),$("#schedule-every-x-hour").val(schedule.scheduleEveryXHour),$("#schedule-every-x-day").val(schedule.scheduleEveryXDay),$("#schedule-every-x-week").val(schedule.scheduleEveryXWeek),$("#schedule-every-x-month").val(schedule.scheduleEveryXMonth),$("#schedule-date-section").show(),$("#schedule-time-section").show(),$("#schedule-url-section").show(),$("#schedule-num-pages-section").show(),(showApiEndpoint=!0)?$("#schedule-api-endpoint-section").show():$("#schedule-api-endpoint-section").hide(),"-1"===schedule.scheduleType?($("#schedule-date-section").hide(),$("#schedule-time-section").hide(),$("#schedule-url-section").hide(),$("#schedule-api-endpoint-section").hide(),$("#schedule-num-pages-section").hide()):"0"===schedule.scheduleType?$("#schedule-every-x-minute-section").show():"1"===schedule.scheduleType?$("#schedule-every-x-hour-section").show():"2"===schedule.scheduleType?$("#schedule-every-x-day-section").show():"3"===schedule.scheduleType?$("#schedule-every-x-week-section").show():"4"===schedule.scheduleType&&$("#schedule-every-x-month-section").show(),$("#schedule-type").val(schedule.scheduleType),$("#schedule-date").val(schedule.startDate),$("#schedule-time").val(schedule.startTime),schedule.url=schedule.url?schedule.url:url,$("#schedule-url").val(schedule.url),$("#schedule-api-endpoint").val(schedule.apiEndpoint),$("#spinner").show(),getJobDependencies([schedule.jobId],{},{},!1,function(e,t){function a(e){if(e.navigate.jquery){var t=createElementType("schedule-num-page-"+e.id,"schedule-num-pages-section","template-num-pages");$(t).find(".num-page-name").text("Number of "+e.name+" pages to Grabb"),schedule.pageCounts||(schedule.pageCounts={}),$(t).find(".num-page-count").val(schedule.pageCounts[e.id]),$(t).find(".num-page-count").change(function(){schedule.pageCounts[e.id]=$(this).val()})}}$("#schedule-num-pages-section").html("");var i=new Set;for(var s in e){var n=e[s];i.has(n.id)||(a(n),i.add(n.id))}for(var s in t){n=t[s];i.has(n.id)||(a(n),i.add(n.id))}$("#spinner").hide()},{cnt:0})}function selectJob(e){(recipe=recipes[e]).owner||((recipe=JSON.parse(JSON.stringify(recipe))).id=null,recipe.name="",recipe.description="",$("#job-visibility").hide(),showPrivateTab&&($("#job-visibility").show(),setTabToPrivate(),recipe.access=jobTabType)),$(".job-item").removeClass("active"),$("#job-item-"+e).addClass("active"),$("#url").attr("href",recipe.url||"").text(recipe.url||""),backupRecipe=JSON.parse(JSON.stringify(recipe))}function setInitialJob(){query=null,$("#recipes-section").hide(),$("#schedule-edit-section").hide(),$("#recipe-edit-section").show(),$("#selected-element-formatted-tags-toggle").show(),$("#help-diagram-toggle").show(),$("#test-button-section").show(),"detail"==recipe.type||"list"==recipe.type||($("#tab-type").show(),$("#tab-details").hide(),$("#tab-navigate").hide(),$("#tab-action").hide(),$("#tab-save").hide(),$("#tab-row").hide(),$("#tab-clean").hide(),$("#tab-columns").hide()),$("#url").val(recipe.url),"easy-scrape"==recipe.typeSelected&&($("#test-button-section").hide(),$("#selected-element-formatted-tags-toggle").hide(),$("#help-diagram-toggle").hide(),enableSpinner(),yank()),editorClean.setValue(recipe.customCleanJS),$("#number-tabs").val(recipe.numberTabs),$("#job-name").val(recipe.name),$("#easy-scrape-job-name").val(recipe.name),$("#job-description").val(recipe.description),$("#easy-scrape-job-visibility").val(recipe.access),$("#job-access-public").val(recipe.access),$("#api-endpoint").val(recipe.apiEndpoint),$("#crawl-regexes").val(recipe.crawlRegexes),$("#url-regexes").val(recipe.regexes),$("#url-regex-patterns").val(recipe.regexes),$("#run-this-tab").val(recipe.runThisTab?"1":"0"),$("#unique-urls-only").val(recipe.uniqueUrlsOnly?"1":"0"),$("#merge-columns").val(recipe.mergeColumns?"1":"0"),$("#delete-empty-rows").val(recipe.deleteEmptyRows?"1":"0"),$("#easy-scrape-job-unique").val(recipe.uniqueUrlsOnly?"1":"0"),$("#easy-scrape-make-tab-active").val(recipe.makeTabActive?"1":"0"),$("#make-tab-active").val(recipe.makeTabActive?"1":"0"),$("#mimic-human").val(recipe.mimicHuman?"1":"0");var e=recipe.links;recipe.links||(recipe.links=[]),$("#link-grabbs").html(""),$("#link-grabbs").val(null).change(),myJobs.map(function(e){$("#link-grabbs").append($("<option></option>").attr("value",e.id).text(e.name))}),$("#link-grabbs").select2({placeholder:"Select Grabb(s) to link"}),$("#link-grabbs").val(e).change();try{$("#max-crawl-depth").val(recipe.crawl.maxCrawlDepth),$("#crawl-wait-time").val(recipe.crawl.waitTime),$("#extract-emails").prop("checked",recipe.crawl.extractEmails),$("#extract-phones").prop("checked",recipe.crawl.extractPhones),$("#extract-addresses").prop("checked",recipe.crawl.extractAddresses)}catch(e){}$("#crawl-section").hide()}function openJob(){window.parent.postMessage({method:"pause-clicking"},"*"),setInitialJob(),updateJobType(),mapQueryToUI()}function isPlayable(e){var t=e.toLowerCase().trim(),a=url.toLowerCase().trim();return new URL(a).origin===new URL(t).origin}function sortJobs(e){for(var t=0;t<e.length;t++){var a=e[t];a.coverage=0;for(var i=a.url.toLowerCase().trim(),s=url.toLowerCase().trim(),n=0;n<i.length&&n<s.length&&i[n]==s[n];n++)a.coverage+=1}return e=e.sort(function(e,t){return t.coverage-e.coverage})}function deletJob(e,t,a){function i(){for(var t=0;t<recipes.length;t++)if(recipes[t].id===e.id){recipe&&e===recipe&&(recipe=null),window.parent.postMessage({method:"fileDelete",data:e.id},"*"),recipes.splice(t,1);break}a&&listItems()}e.id&&(t?runConfirm("Please Confirm","Are you sure you want to delete the job "+e.name+"?",function(t){t&&jobApi.delete(i,fail,e.id)}):jobApi.delete(i,fail,e.id))}function runJob(e){var t=[];t.push(e),window.parent.postMessage({method:"crawlStart",data:t},"*")}function createNewJob(){return{id:null,crawl:{crawlRegexes:null,maxCrawlDepth:1,extractEmails:!1,extractPhones:!1,extractAddresses:!1,waitTime:0},regexes:null,name:"",description:"",numberTabs:"1",type:"",uniqueUrlsOnly:!1,mergeColumns:!1,runThisTab:!1,deleteEmptyRows:!0,makeTabActive:!0,url:url,details:[createQuery()],row:createQuery(),columns:[createQuery()],actions:[],links:[],navigate:createQuery(),owner:!0,mimicHuman:!1,access:jobTabType,apiEndpoint:"",customCleanJS:"\nfunction cleanData(data) {\n    \n    // Please Note:\n    // The first column is always the row Id\n            \n    // Filter rows\n    var newData = [];\n    for (var rowIndex = 0; rowIndex < data.length; rowIndex++) {\n        if (rowIndex % 1 == 0) {\n            newData.push(data[rowIndex]);\n        }\n    }\n    data = newData;\n\n    // Clean data\n    for (var rowIndex = 0; rowIndex < data.length; rowIndex++) {\n        var row = data[rowIndex];\n        for (var colIndex=0; colIndex < row.length; colIndex++) {\n        \n        }\n    }\n    return data;\n}\n            "}}function listHowItWorks(){var e=$("#search-text").val().toLowerCase();$("#items").html(""),$("#first-grab").hide();for(var t=0;t<howItWorksVideos.length;t++){var a=howItWorksVideos[t];if(!e||-1!==a.name.indexOf(e)){var i=createElementType("video-item-"+t,"items","template-video-item");$(i).find(".video-item-text").text(a.name),$(i).find("iframe").attr("src",a.url)}}}function listJobs(){$("#add-new > span:eq(1)").text("+ Start new grabb"),$("#search-text").attr("placeholder","Search Jobs..."),$(".overview-video").show();var e=$("#search-text").val().toLowerCase();$("#items").html(""),$("#add-new").show(),recipes=sortJobs(recipes),$("#first-grab").show();for(var t=0;t<recipes.length;t++)e&&-1===recipes[t].name.toLowerCase().indexOf(e)||recipes[t].name.startsWith("EZ-")||("private"!=jobTabType||recipes[t].owner)&&("public"!=jobTabType||recipes[t].isPopular)&&function(e){$("#first-grab").hide();var t=createElementType("job-item-"+recipes[e].id,"items","template-job-item");t.find(".job-edit").click(function(){selectJob(e),openJob()}),t.find(".job-schedule").click(function(){for(var t=0;t<schedules.length;t++)if(schedules[t].jobId==recipes[e].id)return selectSchedule(t),void openSchedule();schedules.push(createNewSchedule()),schedules[schedules.length-1].jobId=recipes[e].id,selectSchedule(schedules.length-1),openSchedule()}),t.find(".job-run-here").hide(),t.find(".job-run-here-no").show(),isPlayable(recipes[e].url)&&(t.find(".job-run-here").show(),t.find(".job-run-here-no").hide()),t.find(".job-run-here").click(function(){filePause[recipes[e].id]={},filePause[recipes[e].id].isPaused=!1,filePause[recipes[e].id].timestamp=Date.now(),t.find(".extract-resume").hide(),t.find(".extract-pause").show(),t.find(".extract-stop").show(),t.find(".job-run-here").hide(),t.find(".file-status").show(),t.find(".job-schedule").hide(),t.find(".job-delete").hide(),runJob(recipes[e],!0)}),t.find(".job-delete").click(function(){deletJob(recipes[e],!0,!0)}),t.find(".job-item-text").text(recipes[e].name),recipes[e].owner||t.find(".job-delete").hide(),t.find(".job-item-preview-toggle").hide(),t.find(".job-item-preview-download").hide(),t.find(".job-item-preview-parent").hide(),t.find(".job-item-preview-toggle").click(function(){t.find(".job-item-preview-parent").toggle()}),t.find(".file-download").click(function(){t.find(".download-list").toggle()}),t.find(".job-item-preview-download").click(function(){jobApi.reportActivity(function(t){var a=t.quota_left;a>0&&function(){for(var t=[],a=0;a<recipes[e].columns.length;a++)t.push(recipes[e].columns[a].columnName);var i=new CSV,s=document.createElement("a");document.body.appendChild(s),s.style="display: none",s.href=URL.createObjectURL(new Blob([i.createCSV(t,recipes[e].coverage.data)])),s.download=recipes[e].name+".csv",s.click()}(),displayQuotaLeft(a)},fail,1)}),t.find(".job-item-url").text(recipes[e].url),t.find(".job-item-url").attr("title",recipes[e].url),t.find(".job-item-url").attr("href",recipes[e].url)}(t)}function saveJob(e,t,a){if($("#recipe-url").attr("href",e.url).text(e.url),!e.name.trim())return disableSpinner(),void status("Please specify a name for this job",!1);var i={url:e.url,name:e.name,data:JSON.stringify(e),access_level:e.access};window.parent.postMessage({method:"resume-clicking"},"*"),null===e.id||a?jobApi.create(function(a){e.id=a.id,t(e)},spinnerFail,i):jobApi.update(function(a){t(e)},spinnerFail,e.id,i)}function updateJobType(){$("body").css("background-color","#F9F9F9"),$("#tabs").show(),$("#tab-type").hide(),$("#tab-details").hide(),$("#tab-navigate").hide(),$("#tab-action").hide(),$("#tab-save").hide(),$("#tab-row").hide(),$("#tab-clean").hide(),$("#tab-columns").hide(),$("#tab-crawl").hide(),$("#selected-element-formatted-tags-toggle").show(),$("#help-diagram-toggle").show(),"detail"===recipe.type?($("#tab-details").show(),$("#tab-navigate").show(),$("#tab-action").show(),$("#tab-save").show(),$("#tab-clean").show(),$("#tab-details a").text("Details"),$("#tab-navigate a").text("Navigation"),$("#tab-action a").text("Action"),$("#tab-save a").text("Save"),$("#tab-clean a").text("Clean"),$("#tab-details").click()):"crawl"===recipe.type?($("#tab-crawl").show(),$("#tab-action").show(),$("#tab-save").show(),$("#tab-type a").text("Job Type"),$("#tab-action a").text("Action"),$("#tab-save a").text("Save"),$("#tab-crawl").click()):"list"===recipe.type&&"easy-scrape"===recipe.typeSelected?(stepType="easy-scrape",$("#test-button-section").hide(),$("#tabs").hide()):"list"===recipe.type?($("#tab-navigate").show(),$("#tab-action").show(),$("#tab-save").show(),$("#tab-row").show(),$("#tab-columns").show(),$("#tab-clean").show(),$("#tab-row a").text("Row"),$("#tab-columns a").text("Column"),$("#tab-navigate a").text("Navigation"),$("#tab-action a").text("Action"),$("#tab-save a").text("Save"),$("#tab-clean a").text("Clean"),$("#tab-row").click()):($("#tabs").hide(),$("#tab-type")[0].click())}var lastQuery=null;function resetViewState(){$("#tabs .tabs").removeClass("active"),$("#action-helper-top").hide(),$("#recipe-crawl-section").hide(),$("#detail-buttons-section").hide(),$("#action-buttons-section").hide(),$("#column-buttons-section").hide(),$("#clean-section").hide(),$("#recipe-types").hide(),$("#wait-time-section").hide(),$("#max-tab-depth-section").hide(),$("#max-clicks-section").hide(),$("#action-section").hide(),$(".jquery-section").hide(),$(".query-section").hide(),$("#extract-section").hide(),$("#meta-data-section").hide(),$("#element-parent-child").hide(),$("#element-parent-child-header").hide(),$("#visit-url-section-header").hide(),$("#contains-section-header").hide(),$("#scroll-section-header").hide(),$("#action-section-header").hide(),$("#jquery-section-header").hide(),$("#max-tab-depth-section-header").hide(),$("#extract-section-header").hide(),$("#click-behavior-section-header").hide(),$("#scroll-section").hide(),$("#row-buttons-section").hide(),$("#navigation-buttons-section").hide(),$("#visit-url-section").hide(),$("#click-behavior-section").hide(),$("#selector-section").hide(),$("#contains-section").hide(),$("#api-endpoint-section").hide(),$("#number-tabs-section").hide(),$("#recipe-save-section").hide(),$("#detail-helper-2").hide(),$("#detail-helper-1").hide(),$("#jquery-header").hide(),$("#column-name-section").hide(),$("#row-helper-2").hide(),$("#row-helper-1").hide(),$("#column-helper-2").hide(),$("#column-helper-1").hide(),$("#navigation-helper-2").hide(),$("#navigation-helper-1").hide(),$("#customjs-section").hide(),$("#action-helper-1").hide(),$("#action-helper-2").hide(),$("#navigation-test").hide(),$("#action-test").hide(),$("#ez-scrape-section").hide(),$("#recipe-save-as-new").hide(),$("#ez-scrape-selection").hide(),$("#easy-scrape-add-column").hide(),$("#easy-scrape-add-details").hide(),$("#easy-scrape-add-pagination").hide(),$("#easy-scrape-description").hide(),$("#easy-scrape-column-description").hide(),$("#easy-scrape-details-description").hide(),$("#easy-scrape-pagination-description").hide(),$("#easy-scrape-save").hide(),$("#easy-scrape-table").hide(),$("#cancel").hide(),$("#next").hide(),$("#done").hide(),$("#back").hide(),$("#delete").hide(),$("#finish").hide(),$("#easy-scrape-header-add").hide(),$("#easy-scrape-header-edit").hide(),$(".sm-collapse").hide(),$(".sm-expand").show()}function updateJobViewState(){if("save"===stepType)resetViewState(),recipe.id&&$("#recipe-save-as-new").show(),$("#tab-save").addClass("active"),$("#recipe-save-section").show(),showApiEndpoint&&$("#api-endpoint-section").show(),showNumberTabs&&$("#number-tabs-section").show(),lastQuery=null;else if("crawl"===stepType)resetViewState(),$("#meta-data-section").show(),$("#recipe-crawl-section").show(),$("#tab-crawl").addClass("active"),lastQuery=null;else if("easy-scrape-save"===stepType)resetViewState(),$("#easy-scrape-save").show(),$("#ez-scrape-section").show(),$("#cancel").show(),$("#back").show(),$("#finish").show(),lastQuery=null;else if("easy-scrape-column-details"===stepType)resetViewState(),$("#easy-scrape-table").css("height","17em"),$("#easy-scrape-header-add").show(),$("#easy-scrape-column-description").show(),$("#easy-scrape-table").show(),$("#ez-scrape-selection").show(),$("#ez-scrape-section").show(),$("#cancel").show(),$("#done").show(),lastQuery=null;else if("easy-scrape-column-details-edit"===stepType)resetViewState(),$("#easy-scrape-table").css("height","17em"),$("#easy-scrape-header-edit").show(),$("#easy-scrape-column-description").show(),$("#easy-scrape-table").show(),$("#ez-scrape-selection").show(),$("#ez-scrape-section").show(),$("#cancel").show(),$("#done").show(),$("#delete").show(),lastQuery=null;else if("easy-scrape-details"===stepType)resetViewState(),$("#easy-scrape-table").css("height","17em"),$("#easy-scrape-details-description").show(),$("#easy-scrape-table").show(),$("#ez-scrape-section").show(),$("#easy-scrape-add-details").show(),$("#finish").show(),lastQuery=null;else if("easy-scrape-pagination"===stepType)resetViewState(),query=recipe.navigate,$("#easy-scrape-pagination-load").hide(),$("#easy-scrape-pagination-description").show(),query&&query.jquery?($("#easy-scrape-add-pagination").text("- Remove pagination"),$("#easy-scrape-pagination-max-clicks-section").show()):($("#easy-scrape-add-pagination").text("+ Add pagination"),$("#easy-scrape-pagination-max-clicks-section").hide()),$("#ez-scrape-section").show(),$("#easy-scrape-add-pagination").show(),$("#cancel").show(),$("#back").show(),$("#next").show(),lastQuery=null;else if("easy-scrape-column"===stepType)resetViewState(),$("#easy-scrape-table").css("height","17em"),$("#easy-scrape-header-add").show(),$("#easy-scrape-column-description").show(),$("#easy-scrape-table").show(),$("#ez-scrape-selection").show(),$("#ez-scrape-section").show(),$("#cancel").show(),$("#done").show(),lastQuery=null;else if("easy-scrape-column-edit"===stepType)resetViewState(),$("#easy-scrape-table").css("height","17em"),$("#easy-scrape-header-edit").show(),$("#easy-scrape-column-description").show(),$("#easy-scrape-table").show(),$("#ez-scrape-selection").show(),$("#ez-scrape-section").show(),$("#cancel").show(),$("#done").show(),$("#delete").show(),lastQuery=null;else if("easy-scrape"===stepType)resetViewState(),$("#easy-scrape-table").css("height","24em"),$("#easy-scrape-description").show(),$("#easy-scrape-table").show(),$("#ez-scrape-section").show(),$("#easy-scrape-add-column").show(),$("#cancel").show(),$("#next").show(),lastQuery=null;else if("clean"===stepType)$("#video").attr("href",videos.clean),resetViewState(),$("#tab-clean").addClass("active"),$("#meta-data-section").show(),$("#clean-section").show(),lastQuery=null;else if("type"===stepType)resetViewState(),$("#recipe-types").show(),lastQuery=null;else if("details"===stepType)if($("#video").attr("href",videos.detail),$("#column-name-label").text("Column Name"),JSON.stringify(query)===JSON.stringify(createQuery()))resetViewState(),$("#tab-details").addClass("active"),$("#detail-buttons-section").show(),$("#column-name-section").show(),$("#meta-data-section").show(),$("#detail-helper-1").show(),lastQuery=null;else{if(lastQuery&&query===lastQuery)return;resetViewState(),$("#tab-details").addClass("active"),$("#detail-buttons-section").show(),$("#column-name-section").show(),$("#meta-data-section").show(),lastQuery=query,$(".query-section").show(),$("#element-parent-child-header").show(),$("#element-parent-child").hide(),$("#element-parent-child-header").click(),$("#selector-section-header").show(),$("#selector-section").hide(),$("#selector-section-header").click(),$("#selector-sibling-header").show(),$("#selector-sibling").hide(),$("#extract-section-header").show(),$("#extract-section").hide(),$("#jquery-section-header").show(),$(".jquery-section").hide(),$("#extract-section-header").show(),$("#extract-section").hide(),$("#contains-section-header").show(),$("#contains-section").hide(),$("#visit-url-section-header").show(),$("#visit-url-section").hide(),$("#download-link-section").hide(),showDownload&&$("#download-link-section").show()}else if("row"===stepType)if($("#video").attr("href",videos.row),JSON.stringify(query)===JSON.stringify(createQuery()))resetViewState(),$("#tab-row").addClass("active"),$("#row-buttons-section").show(),$("#selector-section").show(),$("#extract-data-toggle").show(),$("#meta-data-section").show(),$("#row-helper-1").show(),lastQuery=null;else{if(lastQuery&&query===lastQuery)return;resetViewState(),$("#tab-row").addClass("active"),$("#row-buttons-section").show(),$("#selector-section").show(),$("#extract-data-toggle").show(),$("#meta-data-section").show(),lastQuery=query,$(".query-section").show(),$("#selector-sibling-header").show(),$("#selector-sibling").hide(),$("#element-parent-child-header").show(),$("#element-parent-child").hide(),$("#element-parent-child-header").click(),$("#selector-section-header").show(),$("#selector-section").hide(),$("#selector-section-header").click(),$("#jquery-section-header").show(),$(".jquery-section").hide()}else if("column"===stepType)if($("#video").attr("href",videos.column),$("#column-name-label").text("Column Name"),JSON.stringify(query)===JSON.stringify(createQuery()))resetViewState(),$("#tab-columns").addClass("active"),$("#column-buttons-section").show(),$("#column-name-section").show(),$("#meta-data-section").show(),$("#column-helper-1").show(),lastQuery=null;else{if(lastQuery&&query===lastQuery)return;resetViewState(),$("#tab-columns").addClass("active"),$("#column-buttons-section").show(),$("#column-name-section").show(),$("#meta-data-section").show(),lastQuery=query,$(".query-section").show(),$("#selector-sibling-header").show(),$("#selector-sibling").hide(),$("#element-parent-child-header").show(),$("#element-parent-child").hide(),$("#element-parent-child-header").click(),$("#selector-section-header").show(),$("#selector-section").hide(),$("#selector-section-header").click(),$("#extract-section-header").show(),$("#extract-section").hide(),$("#jquery-section-header").show(),$(".jquery-section").hide(),$("#download-link-section").hide(),showDownload&&$("#download-link-section").show(),showDeepCrawl&&$("#visit-url-section-header").show()}else if("navigate"===stepType){if($("#video").attr("href",videos.navigation),JSON.stringify(query)===JSON.stringify(createQuery())&&(lastQuery=null),lastQuery&&query===lastQuery)return;resetViewState(),$("#tab-navigate").addClass("active"),$("#wait-time-section").show(),$("#max-clicks-section").show(),$("#meta-data-section").show(),$("#navigation-buttons-section").show(),lastQuery=query,$(".query-section").show(),$("#element-parent-child-header").show(),$("#element-parent-child").hide(),$("#element-parent-child-header").click(),$("#selector-section-header").show(),$("#selector-section").hide(),$("#selector-section-header").click(),$("#selector-sibling-header").show(),$("#selector-sibling").hide(),$("#contains-section-header").show(),$("#contains-section").hide(),$("#click-behavior-section-header").show(),$("#click-behavior-section").hide(),$("#scroll-section-header").show(),$("#scroll-section").hide(),$("#jquery-section-header").show(),$(".jquery-section").hide(),$("#navigation-test").show()}else if("action"===stepType)if($("#column-name-label").text("Action Name"),$("#video").attr("href",videos.action),null===query||0===recipe.actions.length)resetViewState(),$("#tab-action").addClass("active"),$("#action-buttons-section").show(),$("#wait-time-section").show(),$("#max-clicks-section").show(),$("#meta-data-section").show(),$("#action-helper-top").show(),lastQuery=null;else{if(JSON.stringify(query)===JSON.stringify(createQuery())&&(lastQuery=null),lastQuery&&query===lastQuery)return;resetViewState(),$("#tab-action").addClass("active"),$("#action-buttons-section").show(),$("#wait-time-section").show(),$("#max-clicks-section").show(),$("#meta-data-section").show(),$("#column-name-section").show(),lastQuery=query,$(".query-section").show(),$("#selector-sibling-header").show(),$("#selector-sibling").hide(),$("#element-parent-child-header").show(),$("#element-parent-child").hide(),$("#element-parent-child-header").click(),$("#selector-section-header").show(),$("#selector-section").hide(),$("#selector-section-header").click(),$("#jquery-section-header").show(),$(".jquery-section").hide(),$("#click-behavior-section-header").show(),$("#click-behavior-section").hide(),$("#scroll-section-header").show(),$("#scroll-section").hide(),$("#contains-section-header").show(),$("#contains-section").hide(),$("#action-section-header").show(),$("#action-section").hide(),$("#jquery-section-header").show(),$(".jquery-section").hide(),showCustomJS&&$("#customjs-section").show(),$("#action-test").show()}$(".sm-accordian-header:visible > span:nth-child(1) ").each(function(e){var t=$(this).text().trim();t=t.substring(t.indexOf(".")+1),$(this).text(e+1+". "+t)})}function createQuery(){var e={jquery:"",columnName:"",index:-1,waitTime:"",maxClicks:"",maxClicksNoNewData:3,maxTabDepth:"",containsText:"",id:{name:null,value:null},classes:[],tag:{name:null,value:null},actionType:null,scrollTimeMS:null,scrollMaxTimeSeconds:null,customJS:"",extractType:"text",downloadLink:!1,extractAttribute:null,visitUrlJobs:[]};return e}function mapQueryToUI(e){if(saveSpot(),updateJobViewState(),e||(queryStack=[],queryIndex=0),query){$("#classes").html(""),$("#ez-scrape-classes").html("");var t="classes";"easy-scrape"==recipe.typeSelected&&(t="ez-scrape-classes"),$("#"+t).html(""),query.classes.length?$("#classes-parent").show():$("#classes-parent").hide();for(var a=0;a<query.classes.length;a++)!function(e){var a=query.classes[e],i=createElementType("class-"+e,t,"template-class"),s="sm-button-round"+e;i[0].setAttribute("id",s),$("#"+s).find(".class-text").text(query.classes[e].name),$("#"+s).find(".class-text").attr("title",query.classes[e].name),$("#"+s).removeClass("sm-selected"),$("#"+s).click(function(){!function(e,t){e.value=!e.value,$("#"+t).removeClass("sm-selected"),e.value&&$("#"+t).addClass("sm-selected");if("easy-scrape-column"==stepType||"easy-scrape-column-details"==stepType){if(e.value){for(var a="",i=0;i<query.classes.length;i++)query.classes[i].value&&(a+="."+query.classes[i].name);window.parent.postMessage({method:"setRow",data:{jquery:a,col:tabIndex}},"*")}}else setJquery()}(a,s)}),query.classes[e].value&&$("#"+s).addClass("sm-selected")}(a);$("#id").removeClass("sm-selected"),query.id.name?(query.id.value&&$("#id").addClass("sm-selected"),$("#id-parent").show(),$("#id").text(query.id.name)):$("#id-parent").hide(),$("#contains-text").val(query.containsText),$("#tag").removeClass("sm-selected"),query.tag.name?(query.tag.value&&$("#tag").addClass("sm-selected"),$("#tag-parent").show(),$("#tag").text(query.tag.name)):$("#tag-parent").hide(),editor.setValue(query.customJS),$("#action-set-value").val(query.setValue),$("#jseditor").hide(),$("#action-set-value").hide(),query.actionType?($(".action-type").val([query.actionType]),$("#jseditor").hide(),$("#action-set-value").hide(),"customjs"===query.actionType?$("#jseditor").show():"set"===query.actionType&&$("#action-set-value").show()):$(".action-type").prop("checked",!1),query.downloadLink?$("#download-link").prop("checked",!0):$("#download-link").prop("checked",!1),query.extractType?($(".extract-type").val([query.extractType]),$("#easy-scrape-extract-type").val(query.extractType),$("#visit-link-section").hide(),"href"==query.extractType&&$("#visit-link-section").show()):$(".extract-type").prop("checked",!1),"other-attribute"===query.extractType?$("#extract-attribute").show():$("#extract-attribute").hide();var i=query.visitUrlJobs;$("#visit-url-jobs").html(""),$("#visit-url-jobs").val(null).change(),myJobs.map(function(e){$("#visit-url-jobs").append($("<option></option>").attr("value",e.id).text(e.name))}),$("#visit-url-jobs").select2({placeholder:"Select Job(s) for Crawling"}),$("#visit-url-jobs").val(i).change(),$("#column-name").val(query.columnName),$("#easy-scrape-column-name").val(query.columnName),$("#jquery").val(query.jquery),$("#wait-time").val(query.waitTime),$("#max-clicks").val(query.maxClicks),$("#max-clicks-no-new-data").val(query.maxClicksNoNewData),$("#easy-scrape-pagination-max-clicks").val(query.maxClicks),$("#ez-wait-time").val(recipe.navigate.waitTime),$("#ez-max-clicks").val(recipe.navigate.maxClicks),$("#scroll-time-ms-simple").val(recipe.navigate.scrollTimeMS),$("#max-tab-depth").val(query.maxTabDepth),$("#extract-attribute").val(query.extractAttribute),$("#scroll-time-ms").val(query.scrollTimeMS),$("#scroll-max-time-seconds").val(query.scrollMaxTimeSeconds),$("#index").text(query.index<0?"none":query.index),applyQuery()}else $(".query-section").hide()}function setQuery(e){if(query&&"easy-scrape"!==stepType){var t=e.html,a=e.type,i=!1;if(setSelectedElementMetaInfo(t),a?queryStack[queryIndex]=JSON.parse(JSON.stringify({id:query.id,classes:query.classes,tag:query.tag,jquery:query.jquery})):(queryStack=[{}],queryIndex=0),"parent"===a?++queryIndex<queryStack.length?i=!0:queryStack.push({}):"child"===a&&(--queryIndex>=0?i=!0:(queryIndex=0,queryStack.unshift({}))),i&&"easy-scrape"!=recipe.typeSelected)query.id=queryStack[queryIndex].id,query.classes=queryStack[queryIndex].classes,query.tag=queryStack[queryIndex].tag,query.jquery=queryStack[queryIndex].jquery;else{var s=createElement(t);if(s.getAttribute("id")?(query.id.name=s.getAttribute("id"),query.id.value=!1):(query.id.name=null,query.id.value=null),query.classes=[],s.getAttribute("class"))for(var n=0;n<s.classList.length;n++){var c=s.classList[n];c.startsWith("datagasm-")||c.startsWith("grabbly-")||query.classes.push({name:c,value:!1})}if(query.tag.name=s.tagName,query.tag.value=!1,query.jquery="",recipe&&query&&"easy-scrape"===recipe.typeSelected){if("easy-scrape-pagination"==stepType){if(query.jquery=$(s).attr("grabbly-path"),$(s)[0].tagName.toLowerCase()in{a:!0,button:!0}){var o=[];try{o=node.className.split(/\s+/).filter(function(e){return!!e})}catch(e){}query.jquery=$(s)[0].tagName+(s.getAttribute("id")?"#"+s.getAttribute("id"):"")+(o.length?"."+o.join("."):"")+":contains("+$(s).text()+")",console.log("navigation ="+query.jquery)}}else $(s).attr("grabbly-row-new")?(query.jquery=$(s).attr("grabbly-column-new"),query.row={},query.row.jquery=$(s).attr("grabbly-row-new"),query.row.multi={row:$(s).attr("grabbly-row-new"),column:$(s).attr("grabbly-column-new")},query.row.single=$(s).attr("grabbly-path"),console.log("row = "+query.row.jquery),console.log("col = "+query.jquery)):$(s).attr("grabbly-row")?(query.jquery=$(s).attr("grabbly-column"),query.row={},query.row.jquery=$(s).attr("grabbly-row"),query.row.multi={row:$(s).attr("grabbly-row"),column:$(s).attr("grabbly-column")},query.row.single=$(s).attr("grabbly-path"),console.log("row = "+query.row.jquery),console.log("col = "+query.jquery)):$(s).attr("grabbly-path")?(query.jquery=$(s).attr("grabbly-path"),query.row={},query.row.jquery="body",console.log("single = "+query.jquery)):(console.log("not found"),enableSpinner(),window.parent.postMessage({method:"re-yank",data:""},"*"));applyQuery()}}mapQueryToUI(!0)}else console.log("no query!")}function setJquery(){var e="";query.tag.value&&(e+=query.tag.name.toLowerCase()+""),query.id.value&&(e+="#"+query.id.name);for(var t=0;t<query.classes.length;t++)query.classes[t].value&&(e+="."+query.classes[t].name);query.index>-1&&(e+=":eq("+query.index+")"),query.containsText.trim()&&(e+=":contains('"+query.containsText+"')"),query.jquery=e,$("#jquery").val(e),saveSpot(),applyQuery()}function saveSpot(){recipe.saveSpot={stepType:stepType,tabIndex:tabIndex},localStorage.setItem("recipe",JSON.stringify({recipe:recipe}))}function applyQuery(){window.parent.postMessage({method:"recipes",data:recipe},"*")}function selectAction(e){tabIndex=e,query=recipe.actions[e],$(".action-button").removeClass("active"),$("#action-button"+e).addClass("active"),mapQueryToUI()}function listActions(){$("#action-buttons").html("");for(var e=0;e<recipe.actions.length;e++)!function(e){var t=createElementType("action-button"+e,"action-buttons","template-action-button");t.click(function(){selectAction(e)}),recipe.actions[e].columnName?$(t).find("a").text(recipe.actions[e].columnName):$(t).find("a").text("Action "+(e+1))}(e)}function selectColumn(e,t){tabIndex=e,query=t[e],$(".column-button").removeClass("active"),$("#column-button"+e).addClass("active"),$(".column-simple-edit-section").hide(),$(".column-simple-display-section").show(),$(".column-name-label-simple").css("background-color","#c32aff"),$(".column-simple-display-section").css("background-color","#c32aff"),setTimeout(function(){$("#column-button-simple"+e).find(".column-simple-display-section").click()},200),mapQueryToUI()}function listColumns(e){$("#column-buttons").html(""),$("#column-buttons-simple").html(""),$(".column-name-label-simple").css("background-color","#c32aff"),$(".column-simple-display-section").css("background-color","#c32aff"),$("#simple-load-next").hide(),$("#next-button-simple").css("background-color","#C32AFF");for(var t=0;t<e.length;t++)!function(t){e[t].columnIndex=t;var a=createElementType("column-button"+t,"column-buttons","template-column-button");a.click(function(){selectColumn(t,recipe.columns)}),e[t].columnName?$(a).find("a").text(e[t].columnName):$(a).find("a").text("Col "+(t+1))}(t)}function selectDetail(e){tabIndex=e,query=recipe.details[e],$(".detail-button").removeClass("active"),$("#detail-button"+e).addClass("active"),mapQueryToUI()}function listDetails(){$("#detail-buttons").html("");for(var e=0;e<recipe.details.length;e++)!function(e){var t=createElementType("detail-button"+e,"detail-buttons","template-detail-button");t.click(function(){selectDetail(e)});var a=recipe.details[e];a.columnName?$(t).find("a").text(a.columnName):$(t).find("a").text("Detail "+(e+1))}(e)}function getFiles(){window.parent.postMessage({method:"getFiles",data:""},"*"),setTimeout(function(){getFiles()},1e3)}function updateDownloadButtons(e,t){e.find(".file-status").text(t.urlIndex+" / "+t.urlLength),filePause[t.id].isPaused?(e.find(".extract-resume").show(),e.find(".extract-pause").hide()):(e.find(".extract-pause").show(),e.find(".extract-resume").hide())}var deletedFiles={};function listFiles(){if(files)for(var e in files)for(var t=0;t<files[e].length;t++)!function(e,t){var a=files[t][e],i=files[t][e].id;if(!(i in deletedFiles)){var s=$("#job-item-"+t),n="job-item-"+t+" > .download-list";if(n.length&&s.length){var c=$("#download-button-"+i);if(!c.length){if(c=createElementType("download-button-"+i,n,"template-download"),a.isDone||$(c).parent().prepend(c),$(c).find(".download-name").text(a.name),$(c).find(".download-url").text(a.url),$(c).find(".download-url").attr("title",a.url),$(c).find(".download-download").click(function(){window.parent.postMessage({method:"downloadCSV",data:{id:a.id}},"*")}),a.date){var o=a.date,r=o.split(":");r.pop(),$(c).find(".download-date").attr("title",r.join(":")),$(c).find(".download-date").text(o.split(" ")[0])}s.find(".download").show(),s.find(".file-download").show()}if(a.isDone){if("1"!=$(c).attr("done")){if(0==e){s.find(".extract-stop").hide(),s.find(".extract-pause").hide(),s.find(".extract-resume").hide();for(var l=0;l<recipes.length;l++)if(recipes[l].id==t){s.find(".job-run-here").hide(),s.find(".job-run-here-no").show(),isPlayable(recipes[l].url)&&(s.find(".job-run-here").show(),s.find(".job-run-here-no").hide());break}s.find(".job-schedule").show(),"private"==jobTabType&&s.find(".job-delete").show(),s.find(".file-status").hide()}$(c).find(".active-download").hide(),$(c).find(".download-delete").hide(),$(c).hover(function(){$(c).find(".download-delete").show()},function(){$(c).find(".download-delete").hide()}),$(c).find(".download-delete").click(function(){deletedFiles[i]=!0,window.parent.postMessage({method:"delete-file",data:{id:a.id}},"*"),$(c).remove();for(var e=!1,n=0;n<files[t].length;n++)if(!(files[t][n].id in deletedFiles)){e=!0;break}e||s.find(".file-download").hide()}),$(c).attr("done","1")}}else"0"!=$(c).attr("done")&&(filePause[i]={},filePause[i].timestamp=a.pauseTimestamp,filePause[i].isPaused=a.pause,$(c).find(".active-download").show(),$(c).find(".download-delete").hide(),s.find(".file-status").show(),s.find(".job-schedule").hide(),s.find(".job-delete").hide(),s.find(".job-run-here").hide(),s.find(".extract-stop").show(),s.find(".extract-stop").unbind(),s.find(".extract-stop").click(function(){window.parent.postMessage({method:"extractStop",data:i},"*"),s.find(".extract-pause").hide(),s.find(".extract-resume").hide(),s.find(".extract-stop").hide(),s.find(".file-status").hide(),s.find(".job-run-here").show(),s.find(".job-schedule").show(),"private"==jobTabType&&s.find(".job-delete").show()}),s.find(".extract-pause").unbind(),s.find(".extract-pause").click(function(){filePause[i].isPaused=!0,filePause[i].timestamp=Date.now(),s.find(".extract-pause").hide(),s.find(".extract-resume").show(),window.parent.postMessage({method:"extractPause",data:{crawlJobId:i,timestamp:filePause[i].timestamp}},"*")}),s.find(".extract-resume").unbind(),s.find(".extract-resume").click(function(){filePause[i].isPaused=!1,filePause[i].timestamp=Date.now(),s.find(".extract-pause").show(),s.find(".extract-resume").hide(),window.parent.postMessage({method:"extractResume",data:{crawlJobId:i,timestamp:filePause[i].timestamp}},"*")}),$(c).attr("done","0")),a.pauseTimestamp>filePause[i].timestamp&&(filePause[i].timestamp=a.pauseTimestamp,filePause[i].isPaused=a.pause),updateDownloadButtons(s,a)}}}(t,e)}function setTabToPublic(){$("#tabs-recipes .tabs").removeClass("active"),$("#tab-public-jobs").addClass("active"),jobTabType="public"}function setTabToPrivate(){$("#tabs-recipes .tabs").removeClass("active"),$("#tab-private-jobs").addClass("active"),jobTabType="private"}function setTabToHowItWorks(){$("#tabs-recipes .tabs").removeClass("active"),$("#tab-how-it-works").addClass("active"),jobTabType="howItWorks"}function scroll(){window.scrollBy(0,7)}function initRecipeEventListeners(){$("#visit-link-no").click(function(){query.visitUrlJobs=[],$("#visit-link-section").hide()}),$("#visit-link-yes").click(function(){for(var e=$("#easy-scrape-table .grabbly-cell"),t=0;t<e.length;t++){var a=$(e[t]).attr("title");if((a=a.toLowerCase()).startsWith("http")){var i={url:a,jobId:null};query.visitLinkId=uuidv4(),i.visitLinkId=query.visitLinkId,1===query.visitUrlJobs.length&&(i.jobId=query.visitUrlJobs[0]),window.parent.postMessage({method:"auto-open",data:i},"*");break}console.log($(e[t]).attr("title"))}}),$("#easy-scrape-add-pagination").click(function(){$("#easy-scrape-add-pagination").text().indexOf("+")>-1?($("#easy-scrape-pagination-load").show(),query.waitTime=5):(query.jquery="",$("#easy-scrape-pagination-max-clicks-section").hide(),$("#easy-scrape-add-pagination").text("+ Add pagination"))}),$("#show-server-code-sample").click(function(){$("#api-code-samples").is(":visible")?$("#api-code-samples").slideUp(100,function(){}):$("#api-code-samples").slideDown(100,function(){})}),$(".next").click(function(){for(var e=!1,t=0;t<$(".sm-accordian-header:visible").length;t++)if($(this)[0].getBoundingClientRect().y<$($(".sm-accordian-header:visible")[t])[0].getBoundingClientRect().y){$($(".sm-accordian-header:visible")[t]).find(".sm-expand").is(":visible")&&$($(".sm-accordian-header:visible")[t]).click(),e=!0;break}if(e)for(t=0;t<40;t++)setTimeout(scroll,10*t);else window.scrollBy(0,-7e4)}),$("#status").click(function(){$("#status").removeClass("show")}),$("#confirm-yes").click(function(){confirmStatusPostFunc&&confirmStatusPostFunc(!0)}),$("#confirm-no").click(function(){confirmStatusPostFunc&&confirmStatusPostFunc(!1)}),$("#speech-download-got-it").click(function(){$("#speech-download").hide()}),(editor=ace.edit("jseditor")).session.setMode("library/ace/mode/javascript"),editor.session.on("change",function(e){query.customJS=editor.getValue(),saveSpot()}),(editorClean=ace.edit("jseditor-clean")).session.setMode("library/ace/mode/javascript"),editorClean.session.on("change",function(e){recipe.customCleanJS=editorClean.getValue(),saveSpot()}),getFiles(),$("#search").click(function(){listItems()}),$("#search-text").bind("keyup",function(e){listItems()}),$("#tab-public-jobs").click(function(){setTabToPublic(),listItems()}),$("#tab-private-jobs").click(function(){setTabToPrivate(),listItems()}),$("#tab-how-it-works").click(function(){setTabToHowItWorks(),listItems()}),setTabToPublic(),$("#delete").click(function(){"easy-scrape-column-details-edit"===stepType?(recipe.columns.splice(tabIndex,1),query=null,stepType="easy-scrape-details",mapQueryToUI(),applyQuery()):"easy-scrape-column-edit"===stepType&&(recipe.columns.splice(tabIndex,1),query=null,stepType="easy-scrape",mapQueryToUI(),applyQuery())}),$("#cancel").click(function(){"easy-scrape"===stepType?$("#recipe-cancel").click():"easy-scrape-column-details"===stepType?(recipe.columns.splice(recipe.columns.length-1,1),query=null,stepType="easy-scrape-details",mapQueryToUI(),applyQuery()):"easy-scrape-column-details-edit"===stepType?(query=null,recipe.columns[tabIndex]=JSON.parse(JSON.stringify(backupQuery)),stepType="easy-scrape-details",mapQueryToUI(),applyQuery()):"easy-scrape-column-edit"===stepType?(query=null,recipe.columns[tabIndex]=JSON.parse(JSON.stringify(backupQuery)),stepType="easy-scrape",mapQueryToUI(),applyQuery()):"easy-scrape-column"===stepType?(recipe.columns.splice(recipe.columns.length-1,1),query=null,stepType="easy-scrape",mapQueryToUI(),applyQuery()):"easy-scrape-save"===stepType?$("#recipe-cancel").click():"easy-scrape-pagination"===stepType?$("#recipe-cancel").click():"easy-scrape-details"===stepType&&$("#recipe-cancel").click()}),$("#done").click(function(){"easy-scrape"===stepType?$("#recipe-cancel").click():"easy-scrape-column-details-edit"===stepType?(stepType="easy-scrape-details",mapQueryToUI()):"easy-scrape-column-details"===stepType?(stepType="easy-scrape-details",mapQueryToUI()):"easy-scrape-column-edit"===stepType?(stepType="easy-scrape",mapQueryToUI()):"easy-scrape-column"===stepType?(stepType="easy-scrape",mapQueryToUI()):"easy-scrape-pagination"===stepType||"easy-scrape-save"===stepType&&$("#recipe-cancel").click()}),$("#back").click(function(){"easy-scrape"===stepType||"easy-scrape-column"===stepType||("easy-scrape-pagination"===stepType?(stepType="easy-scrape",mapQueryToUI()):"easy-scrape-details"===stepType||"easy-scrape-save"===stepType&&(stepType="easy-scrape-pagination",mapQueryToUI()))}),$("#next").click(function(){"easy-scrape"===stepType?(stepType="easy-scrape-pagination",mapQueryToUI()):"easy-scrape-column"===stepType||("easy-scrape-pagination"===stepType?(stepType="easy-scrape-save",mapQueryToUI()):"easy-scrape-details"===stepType&&(stepType="easy-scrape-save",mapQueryToUI()))}),$("#finish").click(function(){if("easy-scrape-details"===stepType)return recipe.name="EZ-"+formatDate(),void saveJob(recipe,function(e){var t={tabId:autoOpen.tabId,jobId:e.id,visitLinkId:autoOpen.visitLinkId};window.parent.postMessage({method:"linkJobToColumn",data:t},"*"),$("#view-close").click()});localStorage.removeItem("recipe"),saveJob(recipe,getRecipes)}),$("#easy-scrape-pagination-max-clicks").bind("keyup change",function(){query.maxClicks=parseInt($(this).val(),10),isNaN(query.maxClicks)?(query.maxClicks=0,$("#max-clicks").val("")):$("#max-clicks").val(query.maxClicks),saveSpot()}),$(".grabbly-io, #recipe-button-x, #recipe-cancel").click(function(){if(window.parent.postMessage({method:"resume-clicking"},"*"),localStorage.removeItem("recipe"),window.parent.postMessage({method:"clearSelection",data:""},"*"),$("#recipe-edit-section").is(":visible")){for(var e=0;e<recipes.length;e++)if(recipes[e]===recipe){null===recipe.id?recipes.splice(e,1):recipes[e]=backupRecipe;break}listItems(),$("#recipes-section").show(),$("#recipe-edit-section").hide(),$("#meta-data-section").hide()}}),$("#get-selected-element").click(function(){getSelectedElement()}),$("#id").click(function(){query.id.value=!query.id.value,$("#id").removeClass("sm-selected"),query.id.value&&$("#id").addClass("sm-selected"),setJquery()}),$("#tag").click(function(){query.tag.value=!query.tag.value,$("#tag").removeClass("sm-selected"),query.tag.value&&$("#tag").addClass("sm-selected"),setJquery()}),$("#next-button-simple").click(function(){$("#simple-load-next").show(),query=recipe.navigate,$(".column-name-label-simple").css("background-color","#c32aff"),$(".column-simple-display-section").css("background-color","#c32aff"),$("#next-button-simple").css("background-color","#7c2b9c")}),$("#type-easy-scrape").click(function(){recipe.type="list",recipe.access=jobTabType,recipe.typeSelected="easy-scrape",recipe.columns.splice(recipe.columns.length-1,1),query=null,updateJobType(),enableSpinner(),mapQueryToUI(),yank()}),$("#type-list").click(function(){recipe.type="list",recipe.name="",recipe.access=jobTabType,recipe.typeSelected="list",updateJobType()}),$("#create-job-type-detail").click(function(){recipe.type="detail",recipe.name="",updateJobType()}),$("#create-job-type-crawl").click(function(){recipe.type="crawl",recipe.name="",updateJobType()}),$("#visit-url-jobs").bind("keyup change",function(){query.visitUrlJobs=$("#visit-url-jobs").val(),saveSpot()}),$("#link-grabbs").bind("keyup change",function(){recipe.links=$("#link-grabbs").val(),saveSpot()}),$("#easy-scrape-column-name").bind("keyup change",function(){query.columnName=$("#easy-scrape-column-name").val(),saveSpot()}),$("#column-name").bind("keyup change",function(){query.columnName=$("#column-name").val();var e="",t="";"details"===stepType?(e="detail",t="Detail"):"column"===stepType?(e="column",t="Col "):"action"===stepType&&(e="action",t="Action"),query.columnName?$("#"+e+"-button"+tabIndex).find("a").text(query.columnName):$("#"+e+"-button"+tabIndex).find("a").text(t+(tabIndex+1)),saveSpot()}),$("#tab-save").click(function(){query=null,stepType="save",mapQueryToUI()}),$("#tab-type").click(function(){query=null,stepType="type",mapQueryToUI()}),$("#tab-clean").click(function(){query=recipe.clean,stepType="clean",mapQueryToUI()}),$("#tab-details").click(function(){stepType="details",listDetails(),recipe.details.length&&selectDetail(0)}),$("#tab-crawl").click(function(){query=null,stepType="crawl",mapQueryToUI()}),$("#tab-row").click(function(){query=recipe.row,stepType="row",mapQueryToUI()}),$("#tab-columns").click(function(){stepType="column",listColumns(recipe.columns),selectColumn(0,recipe.columns)}),$("#tab-navigate").click(function(){query=recipe.navigate,stepType="navigate",mapQueryToUI()}),$("#tab-action").click(function(){stepType="action",listActions(),recipe.actions.length?selectAction(0):(query=null,mapQueryToUI())}),$("#schedule-every-x-hour").bind("change",function(){schedule.scheduleEveryXHour=$(this).val(),schedule.scheduleEveryXHour?schedule.scheduleEveryXHour<=0&&$("#schedule-every-x-hour").val(1).change():$("#schedule-every-x-hour").val(1).change()}),$("#schedule-every-x-minute").bind("change",function(){schedule.scheduleEveryXMinute=$(this).val(),schedule.scheduleEveryXMinute?schedule.scheduleEveryXMinute<=0&&$("#schedule-every-x-minute").val(1).change():$("#schedule-every-x-minute").val(1).change()}),$("#schedule-every-x-day").bind("change",function(){schedule.scheduleEveryXDay=$(this).val(),schedule.scheduleEveryXDay?schedule.scheduleEveryXDay<=0&&$("#schedule-every-x-day").val(1).change():$("#schedule-every-x-day").val(1).change()}),$("#schedule-every-x-week").bind("change",function(){schedule.scheduleEveryXWeek=$(this).val(),schedule.scheduleEveryXWeek?schedule.scheduleEveryXWeek<=0&&$("#schedule-every-x-week").val(1).change():$("#schedule-every-x-week").val(1).change()}),$("#schedule-every-x-month").bind("change",function(){schedule.scheduleEveryXMonth=$(this).val(),schedule.scheduleEveryXMonth?schedule.scheduleEveryXMonth<=0&&$("#schedule-every-x-month").val(1).change():$("#schedule-every-x-month").val(1).change()}),$("#schedule-type").bind("keyup change",function(){schedule.scheduleType=$(this).val(),mapScheduleToUI()}),$("#schedule-time").bind("keyup change",function(){schedule.startTime=$(this).val()}),$("#schedule-date").bind("keyup change",function(){schedule.startDate=$(this).val()}),$("#schedule-url").bind("change",function(){schedule.url=$(this).val()}),$("#schedule-api-endpoint").bind("change",function(){schedule.apiEndpoint=$(this).val()}),$("#schedule-cancel").click(function(){for(var e=0;e<schedules.length;e++)if(schedules[e]===schedule){null===schedule.id?schedules.splice(e,1):schedules[e]=backupSchedule;break}showItems(),listItems()}),$("#schedule-save").click(function(){if("-1"!=schedule.scheduleType)if(schedule.startDate||schedule.startTime)if(schedule.startDate)if(schedule.startTime)if(schedule.jobId){enableSpinner(),showItems();var e={data:JSON.stringify(schedule)};schedule.id?scheduleApi.update(function(e){disableSpinner(),listItems(),triggerGetSchedules()},spinnerFail,schedule.id,e):scheduleApi.create(function(e){disableSpinner(),schedule.id=e.id,listItems(),triggerGetSchedules()},spinnerFail,e)}else status("Please specify a job",!1);else status("Please specify a start time",!1);else status("Please specify a start date",!1);else status("Please specify a start date and time",!1);else{for(var t=0;t<schedules.length;t++)schedules[t]==schedule&&schedules.splice(t,1);schedule.id?scheduleApi.delete(function(){showItems(),triggerGetSchedules(),listItems()},function(){showItems(),triggerGetSchedules(),listItems(),status("Failure",!1)},schedule.id):(showItems(),listItems())}}),$(".column-close-next-simple").click(function(){recipe.navigate.jquery="",saveSpot(),applyQuery()}),$("#selector-sibling-header").click(function(){$("#selector-sibling").toggle(),$("#selector-sibling").is(":visible")?($("#selector-sibling-header").find(".sm-expand").hide(),$("#selector-sibling-header").find(".sm-collapse").show()):($("#selector-sibling-header").find(".sm-expand").show(),$("#selector-sibling-header").find(".sm-collapse").hide())}),$("#visit-url-section-header").click(function(){$("#visit-url-section").toggle(),$("#visit-url-section").is(":visible")?($("#visit-url-section-header").find(".sm-expand").hide(),$("#visit-url-section-header").find(".sm-collapse").show()):($("#visit-url-section-header").find(".sm-expand").show(),$("#visit-url-section-header").find(".sm-collapse").hide())}),$("#element-parent-child-header").click(function(){$("#element-parent-child").toggle(),$("#element-parent-child").is(":visible")?($("#element-parent-child-header").find(".sm-expand").hide(),$("#element-parent-child-header").find(".sm-collapse").show()):($("#element-parent-child-header").find(".sm-expand").show(),$("#element-parent-child-header").find(".sm-collapse").hide())}),$("#selector-section-header").click(function(){$("#selector-section").toggle(),$("#selector-section").is(":visible")?($("#selector-section-header").find(".sm-expand").hide(),$("#selector-section-header").find(".sm-collapse").show()):($("#selector-section-header").find(".sm-expand").show(),$("#selector-section-header").find(".sm-collapse").hide())}),$("#contains-section-header").click(function(){$("#contains-section").toggle(),$("#contains-section").is(":visible")?($("#contains-section-header").find(".sm-expand").hide(),$("#contains-section-header").find(".sm-collapse").show()):($("#contains-section-header").find(".sm-expand").show(),$("#contains-section-header").find(".sm-collapse").hide())}),$("#scroll-section-header").click(function(){$("#scroll-section").toggle(),$("#scroll-section").is(":visible")?($("#scroll-section-header").find(".sm-expand").hide(),$("#scroll-section-header").find(".sm-collapse").show()):($("#scroll-section-header").find(".sm-expand").show(),$("#scroll-section-header").find(".sm-collapse").hide())}),$("#action-section-header").click(function(){$("#action-section").toggle(),$("#action-section").is(":visible")?($("#action-section-header").find(".sm-expand").hide(),$("#action-section-header").find(".sm-collapse").show()):($("#action-section-header").find(".sm-expand").show(),$("#action-section-header").find(".sm-collapse").hide())}),$("#max-tab-depth-section-header").click(function(){$("#max-tab-depth-section").toggle(),$("#max-tab-depth-section").is(":visible")?($("#max-tab-depth-section-header").find(".sm-expand").hide(),$("#max-tab-depth-section-header").find(".sm-collapse").show()):($("#max-tab-depth-section-header").find(".sm-expand").show(),$("#max-tab-depth-section-header").find(".sm-collapse").hide())}),$("#click-behavior-section-header").click(function(){$("#click-behavior-section").toggle(),$("#click-behavior-section").is(":visible")?($("#click-behavior-section-header").find(".sm-expand").hide(),$("#click-behavior-section-header").find(".sm-collapse").show()):($("#click-behavior-section-header").find(".sm-expand").show(),$("#click-behavior-section-header").find(".sm-collapse").hide())}),$("#jquery-section-header").click(function(){$(".jquery-section").toggle(),$(".jquery-section").is(":visible")?($("#jquery-section-header").find(".sm-expand").hide(),$("#jquery-section-header").find(".sm-collapse").show()):($("#jquery-section-header").find(".sm-expand").show(),$("#jquery-section-header").find(".sm-collapse").hide())}),$("#extract-section-header").click(function(){$("#extract-section").toggle(),$("#extract-section").is(":visible")?($("#extract-section-header").find(".sm-expand").hide(),$("#extract-section-header").find(".sm-collapse").show()):($("#extract-section-header").find(".sm-expand").show(),$("#extract-section-header").find(".sm-collapse").hide())}),$("#add-new, #get-started").click(function(){addNew()}),$("#recipe-clone").click(function(){if(recipe){var e=JSON.parse(JSON.stringify(recipe));e.name=e.name+" Clone",e.id=null,recipes.push(e),listItems(),selectJob(recipes.length-1)}}),$("#recipe-save").click(function(){localStorage.removeItem("recipe"),saveJob(recipe,getRecipes)}),$("#recipe-save-as-new").click(function(){localStorage.removeItem("recipe"),saveJob(recipe,getRecipes,!0)}),$("#job-access-public").change(function(){recipe.access=$(this).val(),saveSpot()}),$("#action-add").click(function(){recipe.actions.push(createQuery()),listActions(),selectAction(recipe.actions.length-1)}),$("#action-clone").click(function(){recipe.actions.push(JSON.parse(JSON.stringify(query))),listActions(),selectAction(recipe.actions.length-1)}),$("#action-move-to").click(function(){var e=parseInt(prompt("Move to position",""),10);if(!(e<=0||e>recipe.actions.length||isNaN(e))){e-=1;for(var t=0;t<recipe.actions.length&&recipe.actions[t]!==query;t++);move(recipe.actions,t,e),listActions(),selectAction(e)}}),$("#action-delete").click(function(){for(var e=0;e<recipe.actions.length;e++)recipe.actions[e]===query&&(recipe.actions.splice(e,1),query=null);listActions(),selectAction(recipe.actions.length-1)}),$("#action-test").click(function(){window.parent.postMessage({method:"action-test",data:query},"*")}),$("#navigation-test").click(function(){window.parent.postMessage({method:"navigation-test",data:query},"*")}),$("#detail-add").click(function(){recipe.details.push(createQuery()),listDetails(),selectDetail(recipe.details.length-1)}),$("#detail-clone").click(function(){recipe.details.push(JSON.parse(JSON.stringify(query))),listDetails(),selectColumn(recipe.details.length-1,recipe.columns)}),$("#detail-move-to").click(function(){var e=parseInt(prompt("Move to position",""),10);if(!(e<=0||e>recipe.details.length||isNaN(e))){e-=1;for(var t=0;t<recipe.details.length&&recipe.details[t]!==query;t++);move(recipe.details,t,e),listDetails(),selectDetail(e)}}),$("#detail-delete").click(function(){if(1!==recipe.details.length){for(var e=0;e<recipe.details.length;e++)if(recipe.details[e]===query){recipe.details.splice(e,1),query=null;break}listDetails(),selectDetail(recipe.details.length-1)}}),$("#column-add").click(function(){recipe.columns.push(createQuery()),listColumns(recipe.columns),selectColumn(recipe.columns.length-1,recipe.columns)}),$("#easy-scrape-add-details").click(function(){recipe.columns.push(createQuery()),stepType="easy-scrape-column-details",listColumns(recipe.columns),selectColumn(recipe.columns.length-1,recipe.columns),applyQuery()}),$("#easy-scrape-add-column").click(function(){recipe.columns.push(createQuery()),stepType="easy-scrape-column",listColumns(recipe.columns),selectColumn(recipe.columns.length-1,recipe.columns),applyQuery()}),$("#column-move-to").click(function(){var e=parseInt(prompt("Move to position",""),10);if(!(e<=0||e>recipe.columns.length||isNaN(e))){e-=1;for(var t=0;t<recipe.columns.length&&recipe.columns[t]!==query;t++);move(recipe.columns,t,e),listColumns(recipe.columns),selectColumn(e,recipe.columns)}}),$("#column-clone").click(function(){recipe.columns.push(JSON.parse(JSON.stringify(query))),listColumns(recipe.columns),selectColumn(recipe.columns.length-1,recipe.columns)}),$("#column-delete").click(function(){if(1!==recipe.columns.length){for(var e=0;e<recipe.columns.length;e++)recipe.columns[e]===query&&(recipe.columns.splice(e,1),query=null);listColumns(recipe.columns),selectColumn(recipe.columns.length-1,recipe.columns)}}),$("#index-up").click(function(){query.index++,$("#index").text(query.index<0?"none":query.index),setJquery(),saveSpot()}),$("#index-down").click(function(){query.index>-1&&(query.index--,$("#index").text(query.index<0?"none":query.index),setJquery()),saveSpot()}),$("#url").bind("keyup change",function(){recipe.url=$("#url").val(),saveSpot()}),$("#easy-scrape-job-name").bind("keyup change",function(){recipe.name=$("#easy-scrape-job-name").val(),saveSpot()}),$("#easy-scrape-job-visibility").change(function(){recipe.access=$("#easy-scrape-job-visibility").val(),saveSpot()}),$("#job-name").bind("keyup change",function(){recipe.name=$("#job-name").val(),saveSpot()}),$("#job-description").bind("keyup change",function(){recipe.description=$("#job-description").val(),saveSpot()}),$("#api-endpoint").bind("keyup change",function(){recipe.apiEndpoint=$("#api-endpoint").val(),saveSpot()}),$("#number-tabs").change(function(){recipe.numberTabs=$("#number-tabs").val(),saveSpot()}),$("#max-crawl-depth").change(function(){recipe.crawl.maxCrawlDepth=$("#max-crawl-depth").val(),saveSpot()}),$("#url-regexes").bind("keyup change",function(){recipe.regexes=$("#url-regexes").val(),saveSpot()}),$("#url-regex-patterns").bind("keyup change",function(){recipe.regexes=$("#url-regex-patterns").val(),saveSpot()}),$("#easy-scrape-job-unique").change(function(){recipe.uniqueUrlsOnly="1"==$(this).val(),saveSpot()}),$("#run-this-tab").change(function(){recipe.runThisTab="1"==$(this).val(),saveSpot()}),$("#unique-urls-only").change(function(){recipe.uniqueUrlsOnly="1"==$(this).val(),saveSpot()}),$("#merge-columns").change(function(){recipe.mergeColumns="1"==$(this).val(),saveSpot()}),$("#delete-empty-rows").change(function(){recipe.deleteEmptyRows="1"==$(this).val(),saveSpot()}),$("#make-tab-active").change(function(){recipe.makeTabActive="1"==$(this).val(),saveSpot()}),$("#mimic-human").change(function(){recipe.mimicHuman="1"==$(this).val(),saveSpot()}),$("#easy-scrape-make-tab-active").change(function(){recipe.makeTabActive="1"==$(this).val(),saveSpot()}),$("#extract-emails").change(function(){recipe.crawl.extractEmails=$(this).prop("checked"),saveSpot(),applyQuery()}),$("#extract-phones").change(function(){recipe.crawl.extractPhones=$(this).prop("checked"),saveSpot(),applyQuery()}),$("#extract-addresses").change(function(){recipe.crawl.extractAddresses=$(this).prop("checked"),saveSpot(),applyQuery()}),$("#crawl-regexes").bind("keyup change",function(){recipe.crawl.crawlRegexes=$("#crawl-regexes").val(),saveSpot()}),$("#ez-wait-time").bind("keyup change",function(){recipe.navigate.waitTime=parseInt($(this).val(),10),isNaN(recipe.navigate.waitTime)?(recipe.navigate.waitTime=0,$("#ez-wait-time").val("")):$("#ez-wait-time").val(recipe.navigate.waitTime),saveSpot()}),$("#wait-time").bind("keyup change",function(){query.waitTime=parseInt($(this).val(),10),isNaN(query.waitTime)?(query.waitTime=0,$("#wait-time").val("")):$("#wait-time").val(query.waitTime),saveSpot()}),$("#crawl-wait-time").bind("keyup change",function(){recipe.crawl.waitTime=parseInt($("#crawl-wait-time").val(),10),isNaN(recipe.crawl.waitTime)?(recipe.crawl.waitTime=0,$("#crawl-wait-time").val("")):$("#crawl-wait-time").val(recipe.crawl.waitTime),saveSpot()}),$("#action-set-value").bind("keyup change",function(){query.setValue=$("#action-set-value").val(),saveSpot()}),$("#scroll-time-ms-simple").bind("keyup change",function(){recipe.navigate.scrollTimeMS=parseInt($(this).val(),10),isNaN(recipe.navigate.scrollTimeMS)?(query.scrollTimeMS=0,$("#scroll-time-ms-simple").val("")):$("#scroll-time-ms-simple").val(recipe.navigate.scrollTimeMS),saveSpot()}),$("#scroll-time-ms, #scroll-time-ms-simple").bind("keyup change",function(){query.scrollTimeMS=parseInt($(this).val(),10),isNaN(query.scrollTimeMS)?(query.scrollTimeMS=0,$("#scroll-time-ms").val("")):$("#scroll-time-ms").val(query.scrollTimeMS),saveSpot()}),$("#ez-max-clicks").bind("keyup change",function(){recipe.navigate.maxClicks=parseInt($(this).val(),10),isNaN(recipe.navigate.maxClicks)?(query.maxClicks=0,$("#ez-max-clicks").val("")):$("#ez-max-clicks").val(recipe.navigate.maxClicks),saveSpot()}),$("#max-clicks").bind("keyup change",function(){query.maxClicks=parseInt($(this).val(),10),isNaN(query.maxClicks)?(query.maxClicks=0,$("#max-clicks").val("")):$("#max-clicks").val(query.maxClicks),saveSpot()}),$("#max-clicks-no-new-data").bind("keyup change",function(){query.maxClicksNoNewData=parseInt($(this).val(),10),isNaN(query.maxClicksNoNewData)?(query.maxClicksNoNewData=0,$("#max-clicks-no-new-data").val("")):$("#max-clicks-no-new-data").val(query.maxClicksNoNewData),saveSpot()}),$("#contains-text").bind("keyup change",function(){query.containsText=$("#contains-text").val(),saveSpot(),setJquery()}),$("#max-tab-depth").bind("keyup change",function(){query.maxTabDepth=parseInt($("#max-tab-depth").val(),10),saveSpot()}),$("#scroll-max-time-seconds").bind("keyup change",function(){query.scrollMaxTimeSeconds=parseInt($("#scroll-max-time-seconds").val(),10),isNaN(query.scrollMaxTimeSeconds)?(query.scrollMaxTimeSeconds=0,$("#scroll-max-time-seconds").val("")):$("#scroll-max-time-seconds").val(query.scrollMaxTimeSeconds),saveSpot()}),$("#extract-attribute").bind("keyup change",function(){query.extractAttribute=$("#extract-attribute").val(),saveSpot(),applyQuery()}),$(".action-type").change(function(){query.actionType=$(this).val(),$("#jseditor").hide(),$("#action-set-value").hide(),"customjs"===query.actionType?$("#jseditor").show():"set"===query.actionType&&$("#action-set-value").show(),saveSpot()}),$(".extract-type, #easy-scrape-extract-type").change(function(){query.extractType=$(this).val(),"other-attribute"===query.extractType?$("#extract-attribute").show():$("#extract-attribute").hide(),saveSpot(),applyQuery()}),$("#download-link").change(function(){query.downloadLink=$(this).prop("checked"),saveSpot(),applyQuery()}),$("#jquery").bind("keyup change",function(){query.jquery=$("#jquery").val(),saveSpot(),applyQuery()})}